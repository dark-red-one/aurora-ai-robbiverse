<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robbie Command Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a18;
            color: #e0e0e0;
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            overflow: hidden;
            display: flex;
            height: 100vh;
            position: relative;
        }

        /* Matrix Background Animation - ENHANCED - Robbie's Colors */
        .matrix-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.15;
            pointer-events: none;
            overflow: hidden;
        }

        .matrix-rain-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .matrix-column-bg {
            position: absolute;
            top: -100%;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            animation: matrix-fall-bg linear infinite;
            opacity: 0.7;
            text-shadow: 0 0 8px currentColor;
        }

        .matrix-column-bg:nth-child(odd) {
            color: #ff6b35;
            /* Robbie's energy - orange */
        }

        .matrix-column-bg:nth-child(even) {
            color: #4ecdc4;
            /* Robbie's intelligence - teal */
        }

        .matrix-column-bg:nth-child(3n) {
            color: #ff6b9d;
            /* Robbie's personality - pink */
        }

        @keyframes matrix-fall-bg {
            0% {
                top: -100%;
                opacity: 0.3;
            }

            50% {
                opacity: 0.6;
            }

            100% {
                top: 100%;
                opacity: 0.1;
            }
        }

        /* ==================== SIDEBAR (Cursor-style) ==================== */
        .sidebar {
            width: 260px;
            background: #0d1117;
            border-right: 2px solid #00d4ff;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        /* Enhanced Matrix Rain in Sidebar - MORE PRONOUNCED */
        .sidebar-matrix {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0.18;
            pointer-events: none;
            overflow: hidden;
        }

        .sidebar-matrix-column {
            position: absolute;
            top: -100%;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            font-weight: bold;
            animation: sidebar-matrix-fall linear infinite;
            opacity: 0.85;
            text-shadow: 0 0 12px currentColor, 0 0 20px currentColor;
            transition: all 0.3s ease;
        }

        .sidebar-matrix-column:hover {
            opacity: 1;
            text-shadow: 0 0 15px currentColor, 0 0 25px currentColor;
        }

        .sidebar-matrix-column:nth-child(odd) {
            color: #ff6b35;
            /* Warm orange - Robbie's energy */
            animation-duration: 6s;
        }

        .sidebar-matrix-column:nth-child(even) {
            color: #4ecdc4;
            /* Teal - Robbie's intelligence */
            animation-duration: 4s;
        }

        .sidebar-matrix-column:nth-child(3n) {
            color: #ff6b9d;
            /* Pink - Robbie's personality */
            animation-duration: 5s;
        }

        .sidebar-matrix-column:nth-child(4n) {
            color: #45b7d1;
            /* Blue - Robbie's calm */
            animation-duration: 7s;
        }

        .sidebar-matrix-column:nth-child(5n) {
            color: #96ceb4;
            /* Mint - Robbie's freshness */
            animation-duration: 3.5s;
        }

        .sidebar-matrix-column:nth-child(6n) {
            color: #feca57;
            /* Gold - Robbie's wisdom */
            animation-duration: 6.5s;
        }

        /* Floating particles */
        .matrix-particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: radial-gradient(circle, currentColor 0%, transparent 70%);
            border-radius: 50%;
            animation: matrix-particle-float linear infinite;
            opacity: 0.7;
        }

        @keyframes sidebar-matrix-fall {
            0% {
                top: -100%;
                opacity: 0.6;
                transform: translateX(0) rotate(0deg);
            }

            25% {
                opacity: 0.8;
                transform: translateX(2px) rotate(1deg);
            }

            50% {
                opacity: 0.9;
                transform: translateX(-1px) rotate(-0.5deg);
            }

            75% {
                opacity: 0.7;
                transform: translateX(1px) rotate(0.5deg);
            }

            100% {
                top: 100%;
                opacity: 0.3;
                transform: translateX(0) rotate(0deg);
            }
        }

        @keyframes matrix-particle-float {
            0% {
                top: 100%;
                left: 0%;
                opacity: 0.8;
                transform: scale(0.5);
            }

            50% {
                opacity: 0.4;
                transform: scale(1.2);
            }

            100% {
                top: -10%;
                left: 100%;
                opacity: 0;
                transform: scale(0.3);
            }
        }

        /* Glitch effect for special characters */
        .matrix-glitch {
            animation: matrix-glitch 0.3s infinite;
        }

        @keyframes matrix-glitch {

            0%,
            100% {
                transform: translateX(0);
            }

            20% {
                transform: translateX(-2px);
            }

            40% {
                transform: translateX(2px);
            }

            60% {
                transform: translateX(-1px);
            }

            80% {
                transform: translateX(1px);
            }
        }

        /* Emergency Buttons */
        .emergency-buttons {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            z-index: 10;
            background: #8b7355;
            /* Office decor wood color */
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .emergency-btn {
            width: 100%;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 8px;
        }

        .emergency-btn:last-child {
            margin-bottom: 0;
        }

        .logout-btn {
            background: linear-gradient(135deg, #ffb088 0%, #ff9a6b 100%);
            /* Burnt orange */
            color: #000;
            /* Bold black text */
            box-shadow: 0 1px 4px rgba(255, 176, 136, 0.3);
        }

        .logout-btn:hover {
            background: linear-gradient(135deg, #ff9a6b 0%, #ff8c5a 100%);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(255, 176, 136, 0.4);
        }

        .killswitch-btn {
            background: linear-gradient(135deg, #ffb088 0%, #ff9a6b 100%);
            /* Burnt orange */
            color: #000;
            /* Bold black text */
            box-shadow: 0 1px 4px rgba(255, 176, 136, 0.3);
        }

        .killswitch-btn:hover {
            background: linear-gradient(135deg, #ff9a6b 0%, #ff8c5a 100%);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(255, 176, 136, 0.4);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.3);
        }

        .sidebar-logo-centered {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            padding: 0 12px;
        }

        /* White pill container for logo */
        .logo-pill {
            background: white;
            padding: 6px 12px;
            border-radius: 12px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .sidebar-logo-centered img {
            height: 24px;
            width: auto;
            display: block;
        }

        /* Logo experiment badge */
        .logo-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid #00d4ff;
            color: #00d4ff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        /* Divider line */
        .sidebar-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.3), transparent);
            margin: 12px 0 8px 0;
        }

        /* Mini divider before monitors */
        .mini-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.15), transparent);
            margin: 8px 0 8px 0;
        }

        /* BeaconTiles Widget Styles - COMPACT MODE */
        .beacon-tiles-container {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 0 12px;
            margin-bottom: 8px;
        }

        .beacon-tile {
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 6px;
            padding: 6px 8px;
            transition: all 0.2s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .beacon-tile:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: rgba(0, 212, 255, 0.4);
        }

        .beacon-tile-header {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .beacon-tile-icon {
            font-size: 12px;
        }

        .beacon-tile-label {
            color: #00d4ff;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 9px;
        }

        .beacon-tile-value {
            color: #0f4;
            font-weight: bold;
            font-size: 14px;
            font-family: 'Courier New', monospace;
        }

        .beacon-tile-trend {
            display: none;
            /* Hidden in compact mode */
        }

        .beacon-tile-bar {
            display: none;
            /* Hidden in compact mode */
        }

        /* Show trend on hover */
        .beacon-tile:hover .beacon-tile-trend {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 9px;
            opacity: 0.8;
            position: absolute;
            right: 8px;
            background: rgba(0, 0, 0, 0.8);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .trend-indicator {
            font-size: 10px;
        }

        .trend-text {
            color: #888;
        }

        .beacon-tile[data-metric="cpu"] .trend-indicator {
            color: #ff6b35;
        }

        .beacon-tile[data-metric="memory"] .trend-indicator {
            color: #4ecdc4;
        }

        .beacon-tile[data-metric="sql"] .trend-indicator {
            color: #96ceb4;
        }

        .sidebar-title {
            font-size: 14px;
            color: #00d4ff;
            font-weight: 600;
            text-align: center;
            margin-bottom: 4px;
        }

        .sidebar-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 12px;
            color: #888;
            margin-top: 3px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #0f4;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .sidebar-avatar {
            height: 220px;
            position: relative;
            background:
                linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="200"><defs><linearGradient id="g1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%2316213e;stop-opacity:1" /><stop offset="50%" style="stop-color:%231a1a2e;stop-opacity:1" /><stop offset="100%" style="stop-color:%230a0a18;stop-opacity:1" /></linearGradient></defs><rect width="300" height="200" fill="url(%23g1)"/><circle cx="50" cy="50" r="30" fill="%2300d4ff" opacity="0.05"/><circle cx="250" cy="150" r="40" fill="%230096ff" opacity="0.03"/></svg>');
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding: 20px 0;
            overflow: hidden;
        }

        .sidebar-location {
            position: absolute;
            bottom: 12px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 11px;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            z-index: 10;
            font-weight: 500;
        }

        .sidebar-avatar-circle {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1e3a5f 0%, #0d1117 100%);
            border: 3px solid #00d4ff;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: visible;
            position: relative;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.4);
            margin-top: 10px;
            margin-bottom: 30px;
            animation: avatarPulse 3s ease-in-out infinite;
        }

        @keyframes avatarPulse {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(0, 212, 255, 0.4);
                transform: scale(1);
            }

            50% {
                box-shadow: 0 0 30px rgba(0, 212, 255, 0.6), 0 0 40px rgba(0, 212, 255, 0.3);
                transform: scale(1.02);
            }
        }

        .sidebar-avatar-circle.thinking {
            animation: avatarThinking 1s ease-in-out infinite;
        }

        @keyframes avatarThinking {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(255, 107, 53, 0.6);
                border-color: #ff6b35;
            }

            50% {
                box-shadow: 0 0 40px rgba(255, 107, 53, 0.8), 0 0 60px rgba(255, 107, 53, 0.4);
                border-color: #ffaa00;
            }
        }

        /* Sparkle effects */
        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #00d4ff;
            border-radius: 50%;
            pointer-events: none;
            animation: sparkleFloat 2s ease-out forwards;
            box-shadow: 0 0 8px rgba(0, 212, 255, 0.8);
        }

        @keyframes sparkleFloat {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }

            100% {
                opacity: 0;
                transform: translate(var(--offset-x, 0), var(--offset-y, -50px)) scale(0.3) rotate(360deg);
            }
        }

        .sidebar-avatar-face {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-avatar-face img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .sidebar-avatar-face img:hover {
            transform: scale(1.05);
        }

        /* Mood tooltip */
        .mood-tooltip {
            position: absolute;
            bottom: 45px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 212, 255, 0.95);
            color: #0a0a18;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.5px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            white-space: nowrap;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0, 212, 255, 0.4);
        }

        .sidebar-avatar-circle:hover .mood-tooltip {
            opacity: 1;
        }

        /* Navigation Widget Enhancement - COMPACT MODE */
        .navigation-widget-container {
            flex: 1;
            padding: 8px 0;
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: 10px;
        }

        .nav-section-title {
            padding: 6px 16px;
            font-size: 9px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar-nav-item {
            display: flex;
            align-items: center;
            padding: 8px 16px;
            cursor: pointer;
            color: #888;
            font-size: 12px;
            transition: all 0.2s;
            border-left: 2px solid transparent;
            position: relative;
        }

        .sidebar-nav-item:hover {
            background: rgba(0, 212, 255, 0.1);
            color: #00d4ff;
        }

        .sidebar-nav-item.active {
            background: rgba(0, 212, 255, 0.15);
            color: #00d4ff;
            border-left-color: #00d4ff;
        }

        .sidebar-nav-icon {
            width: 16px;
            margin-right: 10px;
            font-size: 14px;
            opacity: 0.8;
        }

        .nav-badge {
            margin-left: auto;
            background: #ff6b35;
            color: white;
            font-size: 9px;
            font-weight: 600;
            padding: 1px 5px;
            border-radius: 8px;
            min-width: 16px;
            text-align: center;
        }

        .nav-expand-icon {
            margin-left: auto;
            font-size: 9px;
            transition: transform 0.2s ease;
        }

        .sidebar-nav-item.expandable.expanded .nav-expand-icon {
            transform: rotate(90deg);
        }

        .nav-submenu {
            background: rgba(0, 0, 0, 0.2);
            border-left: 2px solid rgba(0, 212, 255, 0.3);
            margin-left: 16px;
        }

        .submenu-item {
            padding-left: 32px !important;
            font-size: 11px;
        }

        /* ==================== HEADER ==================== */
        .header {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            padding: 14px 20px;
            border-bottom: 2px solid #00d4ff;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0, 212, 255, 0.3);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            font-weight: bold;
            color: #00d4ff;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo img {
            height: 40px;
            width: auto;
        }

        .status-badge {
            background: #0f4;
            color: #000;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .header-right {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .header-info {
            font-size: 12px;
            color: #888;
        }

        /* ==================== MAIN CONTAINER ==================== */
        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ==================== CONTENT AREA ==================== */
        .content-wrapper {
            flex: 1;
            overflow: hidden;
        }

        .tab-content {
            display: none;
            height: 100%;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }

        /* ==================== TERMINAL CHAT (EMBEDDED) ==================== */
        #terminal-embedded {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .terminal-header-embedded {
            border: 2px solid #00d4ff;
            padding: 10px;
            margin-bottom: 10px;
            text-align: center;
            background: #0a2540;
        }

        .terminal-header-embedded .title {
            color: #00d4ff;
            font-weight: bold;
            font-size: 16px;
            letter-spacing: 2px;
        }

        .terminal-header-embedded .subtitle {
            color: #5bc0de;
            font-size: 12px;
            margin-top: 5px;
        }

        .messages-area {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            border: 2px solid #00d4ff;
            padding: 15px;
            background: #0d1b2a;
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            font-size: 14px;
            line-height: 1.8;
            margin-bottom: 10px;
            color: #ffb088;
            /* Lighter burnt orange (3 shades lighter) for all text in messages area */
        }

        .messages-area::-webkit-scrollbar {
            width: 8px;
        }

        .messages-area::-webkit-scrollbar-track {
            background: #0a0a18;
        }

        .messages-area::-webkit-scrollbar-thumb {
            background: #00d4ff;
            border-radius: 4px;
        }

        .message {
            margin-bottom: 8px;
            word-wrap: break-word;
        }

        .message.system {
            color: #ffb088;
            font-weight: 600;
        }

        .message.robbie .username {
            color: #00d4ff;
            font-weight: bold;
        }

        .message.allan .username {
            color: #ff5555;
            font-weight: bold;
        }

        .message .text {
            color: #e0e0e0;
        }

        .message .text strong {
            color: #00ff88;
            font-weight: bold;
        }

        .typing-indicator {
            color: #5bc0de;
            font-style: italic;
        }

        /* Input Area - Redesigned */
        .input-area {
            display: flex;
            align-items: stretch;
            gap: 12px;
        }

        .input-content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-black-box {
            background: #000;
            border: 2px solid #00d4ff;
            border-radius: 4px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-prompt {
            color: #6b9463;
            font-weight: bold;
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            margin-bottom: 4px;
        }

        #messageInput {
            width: 100%;
            background: #000;
            border: none;
            color: #e0e0e0;
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            font-size: 14px;
            outline: none;
            padding: 0;
            caret-color: #0f4;
            resize: none;
            min-height: 60px;
            max-height: 200px;
            overflow-y: auto;
            line-height: 1.4;
        }

        #messageInput:disabled {
            opacity: 0.5;
        }

        /* Button stack on the right */
        .button-stack {
            display: flex;
            flex-direction: column;
            gap: 8px;
            justify-content: center;
        }

        /* File upload button - emoji style */
        .file-button {
            background: #0a2540;
            border: 2px solid #00d4ff;
            color: #00d4ff;
            width: 48px;
            height: 48px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.2s ease;
            position: relative;
        }

        .file-button:hover {
            background: #00d4ff;
            color: #0a0a18;
            transform: scale(1.05);
        }

        .file-button input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        /* Send button - emoji style */
        .send-button {
            background: #0a2540;
            border: 2px solid #0f4;
            color: #0f4;
            width: 48px;
            height: 48px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.2s ease;
        }

        .send-button:hover {
            background: #0f4;
            color: #0a0a18;
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0, 255, 68, 0.3);
        }

        .send-button:active {
            transform: scale(0.95);
        }

        /* File attachments display */
        .file-attachments {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .file-tag {
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid #00d4ff;
            color: #00d4ff;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .file-tag-remove {
            cursor: pointer;
            color: #ff5555;
            font-weight: bold;
        }

        .file-tag-remove:hover {
            color: #ff0000;
        }

        /* Blinking cursor animation */
        @keyframes blink {

            0%,
            50% {
                opacity: 1;
            }

            51%,
            100% {
                opacity: 0;
            }
        }

        #messageInput::after {
            content: '█';
            color: #0f4;
            animation: blink 1s infinite;
        }

        /* Status Bar - HIDDEN */
        .status-bar {
            display: none;
        }

        .status-left {
            color: #0f4;
        }

        .status-right {
            color: #888;
        }

        /* Avatar Rendering - Full Resolution! */
        .avatar-line {
            line-height: 0;
            font-size: 0;
            white-space: nowrap;
            height: 10px;
            display: block;
        }

        .avatar-line span {
            display: inline-block;
            width: 10px;
            height: 10px;
            font-size: 0;
            line-height: 0;
        }

        /* ==================== BEAUTIFUL STICKY NOTES ==================== */
        .sticky-notes-layout {
            display: flex;
            height: 100%;
            gap: 20px;
        }

        .sticky-sidebar {
            width: 280px;
            background: rgba(13, 17, 23, 0.95);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        .sticky-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
        }

        .sticky-header h2 {
            color: #00d4ff;
            font-size: 20px;
            font-weight: 600;
        }

        .new-sticky-btn {
            background: linear-gradient(135deg, #00d4ff, #0099cc);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .new-sticky-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.4);
        }

        .sticky-categories,
        .sticky-authors,
        .sticky-search {
            margin-bottom: 25px;
        }

        .sticky-categories h3,
        .sticky-authors h3,
        .sticky-search h3 {
            color: #e0e0e0;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .category-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 6px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .category-item:hover {
            background: rgba(0, 212, 255, 0.1);
        }

        .category-item.active {
            background: rgba(0, 212, 255, 0.2);
            border-left: 3px solid #00d4ff;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .dot.all {
            background: #e0e0e0;
        }

        .dot.intel {
            background: #FFE082;
        }

        /* Pastel Yellow */
        .dot.reference {
            background: #A5D6A7;
        }

        /* Pastel Green */
        .dot.drafts {
            background: #BBDEFB;
        }

        /* Pastel Blue */
        .dot.connections {
            background: #FFCDD2;
        }

        /* Pastel Red */
        .dot.shower-thoughts {
            background: #E1BEE7;
        }

        /* Pastel Purple */

        .category-item span:not(.dot) {
            color: #e0e0e0;
            font-size: 14px;
        }

        .count {
            margin-left: auto;
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
        }

        .author-filter {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .author-filter label {
            display: flex;
            align-items: center;
            color: #e0e0e0;
            font-size: 14px;
            cursor: pointer;
        }

        .author-filter input[type="checkbox"] {
            margin-right: 8px;
            accent-color: #00d4ff;
            appearance: none;
            -webkit-appearance: none;
        }

        .search-input {
            width: 100%;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 14px;
        }

        .search-input::placeholder {
            color: #888;
        }

        .sticky-main {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
        }

        .sticky-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            padding: 10px 0;
        }

        /* BEAUTIFUL PASTEL STICKY NOTES */
        .sticky-note {
            background: linear-gradient(135deg, #FFE082 0%, #FFC107 100%);
            /* Pastel Yellow */
            color: #333;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            transform: rotate(-1deg);
            min-height: 200px;
            display: flex;
            flex-direction: column;
        }

        .sticky-note:hover {
            transform: rotate(0deg) scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            z-index: 10;
        }

        .sticky-note.locked {
            border: 2px solid #FF6B6B;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .sticky-note.locked::before {
            content: '🔒';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 16px;
        }

        /* Pastel Color Variants */
        .sticky-note.intel {
            background: linear-gradient(135deg, #FFE082 0%, #FFC107 100%);
            /* Pastel Yellow */
            color: #333;
        }

        .sticky-note.reference {
            background: linear-gradient(135deg, #A5D6A7 0%, #81C784 100%);
            /* Pastel Green */
            color: #2E7D32;
        }

        .sticky-note.drafts {
            background: linear-gradient(135deg, #BBDEFB 0%, #90CAF9 100%);
            /* Pastel Blue */
            color: #1565C0;
        }

        .sticky-note.connections {
            background: linear-gradient(135deg, #FFCDD2 0%, #EF9A9A 100%);
            /* Pastel Red */
            color: #C62828;
        }

        .sticky-note.shower-thoughts {
            background: linear-gradient(135deg, #E1BEE7 0%, #CE93D8 100%);
            /* Pastel Purple */
            color: #7B1FA2;
        }

        .sticky-note-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .sticky-note-title {
            font-size: 16px;
            font-weight: 600;
            line-height: 1.3;
            flex: 1;
            margin-right: 10px;
        }

        .sticky-note-category {
            background: rgba(255, 255, 255, 0.3);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sticky-note-content {
            flex: 1;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 12px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 6;
            line-clamp: 6;
            -webkit-box-orient: vertical;
        }

        .sticky-note-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            opacity: 0.8;
            margin-top: auto;
        }

        .sticky-note-author {
            font-weight: 500;
        }

        .sticky-note-date {
            font-style: italic;
        }

        .sticky-note-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            display: none;
            gap: 4px;
        }

        .sticky-note:hover .sticky-note-actions {
            display: flex;
        }

        .sticky-action-btn {
            background: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 4px;
            padding: 4px 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .sticky-action-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.1);
        }

        /* Modal Styles */
        .sticky-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .sticky-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1a1a2e;
            border: 2px solid #00d4ff;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .sticky-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
        }

        .sticky-modal-header h3 {
            color: #00d4ff;
            font-size: 18px;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            color: #e0e0e0;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sticky-modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #e0e0e0;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 14px;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .sticky-modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 20px;
            border-top: 1px solid rgba(0, 212, 255, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #00d4ff, #0099cc);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            border: 1px solid rgba(0, 212, 255, 0.2);
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* ==================== COMMS TAB ==================== */
        .comms-dashboard {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            height: 100%;
        }

        .comms-sidebar {
            background: #0d1117;
            border: 2px solid #00d4ff;
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
        }

        .comms-main {
            background: #0d1117;
            border: 2px solid #00d4ff;
            border-radius: 8px;
            padding: 20px;
            overflow-y: auto;
        }

        .comms-filter {
            margin-bottom: 20px;
        }

        .filter-btn {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 8px;
            background: transparent;
            border: 1px solid #00d4ff;
            color: #00d4ff;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: rgba(0, 212, 255, 0.2);
        }

        .comm-item {
            background: #1a1a2e;
            border-left: 4px solid #00d4ff;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .comm-item:hover {
            background: #16213e;
            transform: translateX(4px);
        }

        .comm-sender {
            font-weight: bold;
            color: #00d4ff;
            margin-bottom: 4px;
        }

        .comm-subject {
            color: #e0e0e0;
            margin-bottom: 6px;
        }

        .comm-preview {
            color: #888;
            font-size: 12px;
        }

        /* ==================== PLACEHOLDER STYLES ==================== */
        .placeholder {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .placeholder-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .placeholder-text {
            font-size: 18px;
            margin-bottom: 8px;
        }

        .placeholder-subtext {
            font-size: 14px;
        }

        /* ==================== MONEY DASHBOARD ==================== */
        .money-dashboard {
            padding: 2rem;
        }

        .money-dashboard h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 2rem;
            color: #00d4ff;
        }

        .money-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .money-stat-card {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(0, 212, 255, 0.05));
            border: 2px solid rgba(0, 212, 255, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .money-stat-card:hover {
            border-color: rgba(0, 212, 255, 0.6);
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 212, 255, 0.2);
        }

        .stat-label {
            font-size: 0.875rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #0f4;
            margin-bottom: 0.5rem;
            font-family: 'Courier New', monospace;
        }

        .stat-trend {
            font-size: 0.875rem;
            color: #888;
        }

        .stat-trend.positive {
            color: #0f4;
        }

        .stat-trend.positive::before {
            content: '↑ ';
        }

        .stat-trend.negative {
            color: #ff6b6b;
        }

        .stat-trend.negative::before {
            content: '↓ ';
        }

        /* ==================== SETUP TAB ==================== */
        .setup-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Personality Sliders Section */
        .personality-section {
            background: rgba(13, 17, 23, 0.6);
            border: 2px solid #00d4ff;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
        }

        .personality-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(0, 212, 255, 0.3);
        }

        .personality-header h2 {
            margin: 0;
            color: #00d4ff;
            font-size: 24px;
        }

        .robbie-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 20px;
            border: 1px solid #00d4ff;
        }

        .status-emoji {
            font-size: 20px;
        }

        .status-text {
            font-weight: 500;
            color: #00d4ff;
        }

        .personality-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }

        .personality-section-card {
            background: rgba(10, 14, 20, 0.8);
            border-radius: 10px;
            padding: 25px;
            border: 1px solid rgba(0, 212, 255, 0.2);
        }

        .personality-section-card h3 {
            margin: 0 0 20px 0;
            color: #00d4ff;
            font-size: 18px;
        }

        .personality-slider {
            background: rgba(13, 17, 23, 0.6);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid rgba(0, 212, 255, 0.15);
            margin-bottom: 20px;
        }

        .personality-slider:last-child {
            margin-bottom: 0;
        }

        .slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .slider-header h4 {
            margin: 0;
            color: #e0e0e0;
            font-size: 16px;
        }

        .slider-current {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 15px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        .current-emoji {
            font-size: 16px;
        }

        .current-name {
            font-weight: 500;
            color: #00d4ff;
            font-size: 14px;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 13px;
            color: #8a8a8a;
            font-weight: 500;
        }

        .personality-slider-input {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, rgba(0, 212, 255, 0.3) 0%, rgba(0, 212, 255, 0.6) 50%, rgba(255, 107, 53, 0.6) 100%);
            outline: none;
            cursor: pointer;
            margin-bottom: 10px;
            -webkit-appearance: none;
        }

        .personality-slider-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00d4ff;
            border: 3px solid #0a0e14;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
            transition: all 0.2s ease;
        }

        .personality-slider-input::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.8);
        }

        .personality-slider-input::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00d4ff;
            border: 3px solid #0a0e14;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
            transition: all 0.2s ease;
        }

        .slider-description {
            font-size: 13px;
            color: #8a8a8a;
            line-height: 1.4;
            font-style: italic;
        }

        .robbie-feedback {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(255, 107, 53, 0.1) 100%);
            border-radius: 12px;
            padding: 25px;
            border: 2px solid rgba(0, 212, 255, 0.3);
            text-align: center;
            transition: all 0.3s ease;
        }

        .robbie-feedback.feedback-active {
            border-color: #ff6b35;
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.2) 0%, rgba(255, 107, 53, 0.1) 100%);
            animation: feedbackPulse 0.5s ease;
        }

        .feedback-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .feedback-emoji {
            font-size: 32px;
        }

        .feedback-text {
            font-size: 18px;
            font-weight: 500;
            color: #e0e0e0;
            font-style: italic;
        }

        @keyframes feedbackPulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }

            100% {
                transform: scale(1);
            }
        }

        /* Integrations Header */
        .integrations-header {
            margin-bottom: 30px;
        }

        .integrations-header h2 {
            margin: 0 0 10px 0;
            color: #00d4ff;
            font-size: 24px;
        }

        .integrations-header p {
            margin: 0;
            color: #8a8a8a;
            font-size: 14px;
        }

        .setup-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .setup-header h1 {
            color: #00d4ff;
            font-size: 32px;
            margin-bottom: 12px;
        }

        .setup-header p {
            color: #888;
            font-size: 16px;
        }

        .setup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .setup-card {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid #00d4ff;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .setup-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 24px rgba(0, 212, 255, 0.4);
            border-color: #00ff88;
        }

        .setup-card.connected {
            border-color: #0f4;
            background: linear-gradient(135deg, #1a2e1a, #162e21);
        }

        .setup-card.connected:hover {
            border-color: #0f4;
        }

        .setup-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .setup-title {
            font-size: 20px;
            font-weight: bold;
            color: #00d4ff;
            margin-bottom: 8px;
        }

        .setup-card.connected .setup-title {
            color: #0f4;
        }

        .setup-description {
            font-size: 14px;
            color: #888;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .setup-button {
            background: #00d4ff;
            color: #0a0a18;
            border: none;
            padding: 12px 28px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .setup-button:hover {
            background: #00ff88;
            transform: scale(1.05);
        }

        .setup-button.connected {
            background: #0f4;
        }

        .setup-button.connected:hover {
            background: #0a3;
        }

        .setup-status {
            margin-top: 12px;
            font-size: 12px;
            color: #0f4;
            font-weight: 600;
        }

        .setup-footer {
            text-align: center;
            padding: 30px 20px;
            border-top: 1px solid #00d4ff;
            margin-top: 40px;
        }

        .setup-footer-text {
            color: #888;
            font-size: 14px;
            line-height: 1.6;
        }

        /* ==================== SYNC DASHBOARD ==================== */
        .sync-dashboard-section {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid #00d4ff;
            border-radius: 12px;
            padding: 24px;
            margin: 30px 0;
        }

        .sync-dashboard-title {
            color: #00d4ff;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            text-align: center;
        }

        .sync-dashboard-subtitle {
            color: #888;
            font-size: 14px;
            text-align: center;
            margin-bottom: 24px;
        }

        .sync-status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .sync-status-card {
            background: linear-gradient(135deg, #0d1117, #161b22);
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .sync-status-card:hover {
            border-color: #00d4ff;
            transform: translateY(-2px);
        }

        .sync-status-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .sync-status-icon {
            font-size: 16px;
        }

        .sync-status-label {
            color: #888;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sync-status-value {
            color: #00d4ff;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .sync-status-detail {
            color: #666;
            font-size: 11px;
        }

        .sync-controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .sync-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sync-btn-icon {
            font-size: 14px;
        }

        .sync-btn-primary {
            background: #00d4ff;
            color: #0a0a18;
        }

        .sync-btn-primary:hover {
            background: #00ff88;
            transform: scale(1.05);
        }

        .sync-btn-secondary {
            background: #30363d;
            color: #e0e0e0;
            border: 1px solid #00d4ff;
        }

        .sync-btn-secondary:hover {
            background: #00d4ff;
            color: #0a0a18;
        }

        .sync-btn-warning {
            background: #ffc107;
            color: #0a0a18;
        }

        .sync-btn-warning:hover {
            background: #ff8c00;
            transform: scale(1.05);
        }

        .sync-logs {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            overflow: hidden;
        }

        .sync-logs-header {
            background: #161b22;
            padding: 12px 16px;
            border-bottom: 1px solid #30363d;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            color: #e0e0e0;
        }

        .sync-logs-icon {
            font-size: 14px;
        }

        .sync-logs-content {
            padding: 16px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            line-height: 1.4;
            color: #888;
            max-height: 120px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .sync-logs-content::-webkit-scrollbar {
            width: 6px;
        }

        .sync-logs-content::-webkit-scrollbar-track {
            background: #161b22;
        }

        .sync-logs-content::-webkit-scrollbar-thumb {
            background: #00d4ff;
            border-radius: 3px;
        }

        .testpilot-pill {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>

<body>
    <!-- Matrix Background Animation -->
    <div class="matrix-background">
        <div class="matrix-rain-bg" id="matrixRainBg"></div>
    </div>
    <!-- ==================== SIDEBAR (Cursor-style) ==================== -->
    <div class="sidebar">
        <!-- Matrix Rain in Sidebar -->
        <div class="sidebar-matrix" id="sidebarMatrix"></div>
        <div class="sidebar-header">
            <div class="sidebar-avatar" id="robbieAvatarContainer" data-location="allans-office">
                <div class="sidebar-avatar-circle" onclick="handleAvatarClick()">
                    <div class="sidebar-avatar-face" id="robbieAvatarSidebar"></div>
                    <div class="mood-tooltip" id="robbieMoodTooltip">😊 Friendly</div>
                </div>
                <div class="sidebar-location" id="robbieLocation">📍 Allan's Office</div>
            </div>

            <div class="sidebar-status">
                <span class="status-dot"></span>
                <span>ONLINE</span>
            </div>

            <div class="mini-divider"></div>

            <!-- BeaconTiles Widget Integration - COMPACT MODE -->
            <div class="beacon-tiles-container" id="beaconTilesContainer">
                <div class="beacon-tile" data-metric="cpu">
                    <div class="beacon-tile-header">
                        <span class="beacon-tile-icon">🔥</span>
                        <span class="beacon-tile-label">CPU</span>
                    </div>
                    <div class="beacon-tile-value" id="cpuValue">12%</div>
                    <div class="beacon-tile-trend" id="cpuTrend">
                        <span class="trend-indicator">↑</span>
                        <span class="trend-text">+2%</span>
                    </div>
                </div>
                <div class="beacon-tile" data-metric="memory">
                    <div class="beacon-tile-header">
                        <span class="beacon-tile-icon">💾</span>
                        <span class="beacon-tile-label">MEM</span>
                    </div>
                    <div class="beacon-tile-value" id="memValue">34%</div>
                    <div class="beacon-tile-trend" id="memTrend">
                        <span class="trend-indicator">→</span>
                        <span class="trend-text">stable</span>
                    </div>
                </div>
                <div class="beacon-tile" data-metric="sql">
                    <div class="beacon-tile-header">
                        <span class="beacon-tile-icon">🗄️</span>
                        <span class="beacon-tile-label">SQL</span>
                    </div>
                    <div class="beacon-tile-value" id="sqlValue">61/min</div>
                    <div class="beacon-tile-trend" id="sqlTrend">
                        <span class="trend-indicator">↓</span>
                        <span class="trend-text">-5/min</span>
                    </div>
                </div>
            </div>

            <div class="sidebar-divider"></div>
        </div>
        <!-- Navigation Widget Integration -->
        <div class="navigation-widget-container">
            <div class="nav-section">
                <div class="nav-section-title">Main</div>
                <div class="sidebar-nav-item active" data-tab="chat">
                    <span class="sidebar-nav-icon">💬</span>
                    <span>Chat</span>
                    <span class="nav-badge">3</span>
                </div>
                <div class="sidebar-nav-item" data-tab="notes">
                    <span class="sidebar-nav-icon">📝</span>
                    <span>Notes</span>
                </div>
                <div class="sidebar-nav-item" data-tab="comms">
                    <span class="sidebar-nav-icon">📧</span>
                    <span>Comms</span>
                    <span class="nav-badge">12</span>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Productivity</div>
                <div class="sidebar-nav-item" data-tab="tasks">
                    <span class="sidebar-nav-icon">✅</span>
                    <span>Tasks</span>
                    <span class="nav-badge">5</span>
                </div>
                <div class="sidebar-nav-item" data-tab="calendar">
                    <span class="sidebar-nav-icon">📅</span>
                    <span>Calendar</span>
                </div>
                <div class="sidebar-nav-item expandable" data-tab="money">
                    <span class="sidebar-nav-icon">💰</span>
                    <span>Money</span>
                    <span class="nav-expand-icon">▶</span>
                </div>
                <div class="nav-submenu" data-parent="money" style="display: none;">
                    <div class="sidebar-nav-item submenu-item" data-tab="money-deals">
                        <span class="sidebar-nav-icon">🤝</span>
                        <span>Deals</span>
                    </div>
                    <div class="sidebar-nav-item submenu-item" data-tab="money-revenue">
                        <span class="sidebar-nav-icon">📈</span>
                        <span>Revenue</span>
                    </div>
                    <div class="sidebar-nav-item submenu-item" data-tab="money-expenses">
                        <span class="sidebar-nav-icon">💸</span>
                        <span>Expenses</span>
                    </div>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">System</div>
                <div class="sidebar-nav-item expandable" data-tab="setup">
                    <span class="sidebar-nav-icon">⚙️</span>
                    <span>Setup</span>
                    <span class="nav-expand-icon">▶</span>
                </div>
                <div class="nav-submenu" data-parent="setup" style="display: none;">
                    <div class="sidebar-nav-item submenu-item" data-tab="setup-personality">
                        <span class="sidebar-nav-icon">🎭</span>
                        <span>Personality</span>
                    </div>
                    <div class="sidebar-nav-item submenu-item" data-tab="setup-integrations">
                        <span class="sidebar-nav-icon">🔌</span>
                        <span>Integrations</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emergency Buttons -->
        <div class="emergency-buttons">
            <button class="emergency-btn logout-btn" onclick="logout()">
                LOGOUT
            </button>
            <button class="emergency-btn killswitch-btn" onclick="killswitch()">
                KILLSWITCH
            </button>
        </div>
    </div>

    <!-- ==================== MAIN CONTAINER ==================== -->
    <div class="main-container">
        <!-- ==================== HEADER ==================== -->
        <div class="header">
            <div class="header-left">
                <div class="logo">
                    <div class="testpilot-pill">TestPilot CPG</div>
                </div>
            </div>
            <div class="header-right">
                <div class="header-info">
                    <span id="localTime">--:--:--</span> •
                    <span id="localWeather">☁️ --°F</span> •
                    <span id="nextEvent">📅 No events</span>
                </div>
            </div>
        </div>

        <!-- ==================== CONTENT AREA ==================== -->
        <div class="content-wrapper">
            <!-- CHAT TAB (TERMINAL) -->
            <div id="chat" class="tab-content active">
                <div id="terminal-embedded">
                    <div class="terminal-header-embedded">
                        <div class="title">═══════════════════════════════════════════════════════════════</div>
                        <div class="title">ROBBIE TERMINAL v3.0 • TestPilot CPG Network</div>
                        <div class="title">═══════════════════════════════════════════════════════════════</div>
                        <div class="subtitle" id="terminalSubtitle">aurora:8007 • Detecting hardware... • Status: ONLINE
                        </div>
                    </div>

                    <div class="messages-area" id="messagesArea"></div>

                    <div class="input-area">
                        <div class="input-content-wrapper">
                            <div id="fileAttachments" class="file-attachments"></div>
                            <div class="input-black-box">
                                <span class="input-prompt">&lt;Allan&gt;</span>
                                <textarea id="messageInput"
                                    placeholder="Type message or /help for commands... (Shift+Enter for new line)"
                                    disabled></textarea>
                            </div>
                        </div>
                        <div class="button-stack">
                            <!-- File upload disabled for now
                            <div class="file-button" title="Attach files">
                                <input type="file" id="fileInput" multiple accept="image/*,.pdf,.txt,.md,.json,.csv">
                                📎
                            </div>
                            -->
                        </div>
                    </div>

                    <!-- Legacy status bar removed to avoid confusion with header info -->
                </div>
            </div>

            <!-- NOTES TAB - BEAUTIFUL STICKY NOTES -->
            <div id="notes" class="tab-content">
                <div class="sticky-notes-layout">
                    <!-- Sticky Notes Sidebar -->
                    <div class="sticky-sidebar">
                        <div class="sticky-header">
                            <h2>🎨 Stickies</h2>
                            <button class="new-sticky-btn" onclick="createNewSticky()">+ New</button>
                        </div>

                        <!-- Categories Filter -->
                        <div class="sticky-categories">
                            <h3>Categories</h3>
                            <div class="category-filter">
                                <div class="category-item active" data-category="all">
                                    <span class="dot all"></span>
                                    <span>All Notes</span>
                                    <span class="count" id="all-count">0</span>
                                </div>
                                <div class="category-item" data-category="intel">
                                    <span class="dot intel"></span>
                                    <span>Intel</span>
                                    <span class="count" id="intel-count">0</span>
                                </div>
                                <div class="category-item" data-category="reference">
                                    <span class="dot reference"></span>
                                    <span>Reference</span>
                                    <span class="count" id="reference-count">0</span>
                                </div>
                                <div class="category-item" data-category="drafts">
                                    <span class="dot drafts"></span>
                                    <span>Drafts</span>
                                    <span class="count" id="drafts-count">0</span>
                                </div>
                                <div class="category-item" data-category="connections">
                                    <span class="dot connections"></span>
                                    <span>Connections</span>
                                    <span class="count" id="connections-count">0</span>
                                </div>
                                <div class="category-item" data-category="shower-thoughts">
                                    <span class="dot shower-thoughts"></span>
                                    <span>Shower Thoughts</span>
                                    <span class="count" id="shower-thoughts-count">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Author Filter -->
                        <div class="sticky-authors">
                            <h3>Author</h3>
                            <div class="author-filter">
                                <label><input type="checkbox" checked id="allan-filter"> Allan's Notes</label>
                                <label><input type="checkbox" checked id="robbie-filter"> Robbie's Notes</label>
                            </div>
                        </div>

                        <!-- Search -->
                        <div class="sticky-search">
                            <h3>Search</h3>
                            <input type="text" placeholder="Search notes..." class="search-input" id="sticky-search">
                        </div>
                    </div>

                    <!-- Sticky Notes Main Area -->
                    <div class="sticky-main">
                        <div class="sticky-grid" id="sticky-grid">
                            <!-- Sticky notes will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Sticky Note Modal (for editing) -->
                <div id="sticky-modal" class="sticky-modal">
                    <div class="sticky-modal-content">
                        <div class="sticky-modal-header">
                            <h3 id="modal-title">Edit Sticky Note</h3>
                            <button class="close-modal" onclick="closeStickyModal()">&times;</button>
                        </div>
                        <div class="sticky-modal-body">
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" id="modal-title-input" placeholder="Note title...">
                            </div>
                            <div class="form-group">
                                <label>Category</label>
                                <select id="modal-category">
                                    <option value="intel">Intel</option>
                                    <option value="reference">Reference</option>
                                    <option value="drafts">Drafts</option>
                                    <option value="connections">Connections</option>
                                    <option value="shower-thoughts">Shower Thoughts</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Content</label>
                                <textarea id="modal-content" placeholder="Note content..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Author</label>
                                <select id="modal-author">
                                    <option value="Allan">Allan</option>
                                    <option value="Robbie">Robbie</option>
                                </select>
                            </div>
                        </div>
                        <div class="sticky-modal-footer">
                            <button class="btn-secondary" onclick="closeStickyModal()">Cancel</button>
                            <button class="btn-primary" onclick="saveStickyNote()">Save</button>
                            <button class="btn-danger" id="delete-btn" onclick="deleteStickyNote()"
                                style="display: none;">Delete</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- COMMS TAB -->
            <div id="comms" class="tab-content">
                <div class="comms-dashboard">
                    <div class="comms-sidebar">
                        <div class="comms-filter">
                            <button class="filter-btn active">📧 All Messages</button>
                            <button class="filter-btn">📨 Unread (5)</button>
                            <button class="filter-btn">⭐ Important</button>
                            <button class="filter-btn">💬 Slack</button>
                            <button class="filter-btn">📱 SMS</button>
                        </div>
                    </div>
                    <div class="comms-main">
                        <div class="comm-item">
                            <div class="comm-sender">Michael Chen - Trader Joe's</div>
                            <div class="comm-subject">Q1 Pilot Budget Approval</div>
                            <div class="comm-preview">Hi Allan, I wanted to follow up on the Q1 pilot budget...</div>
                        </div>
                        <div class="placeholder">
                            <div class="placeholder-icon">📧</div>
                            <div class="placeholder-text">Universal Communications Dashboard</div>
                            <div class="placeholder-subtext">Email, Slack, SMS - all in one place (coming soon)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TASKS TAB -->
            <div id="tasks" class="tab-content">
                <div class="placeholder">
                    <div class="placeholder-icon">✅</div>
                    <div class="placeholder-text">Task Management</div>
                    <div class="placeholder-subtext">Your priority tasks and action items</div>
                </div>
            </div>

            <!-- MONEY TAB - Main Dashboard -->
            <div id="money" class="tab-content">
                <div class="money-dashboard">
                    <h1>💰 Financial Dashboard</h1>
                    <div class="money-stats">
                        <div class="money-stat-card">
                            <div class="stat-label">Monthly Revenue</div>
                            <div class="stat-value">$12,740</div>
                            <div class="stat-trend positive">+$12,740 this month</div>
                        </div>
                        <div class="money-stat-card">
                            <div class="stat-label">Active Deals</div>
                            <div class="stat-value">3</div>
                            <div class="stat-trend">Pipeline: $45,000</div>
                        </div>
                        <div class="money-stat-card">
                            <div class="stat-label">Monthly Expenses</div>
                            <div class="stat-value">$2,340</div>
                            <div class="stat-trend negative">+$340 vs last month</div>
                        </div>
                        <div class="money-stat-card">
                            <div class="stat-label">Net Profit</div>
                            <div class="stat-value">$10,400</div>
                            <div class="stat-trend positive">82% margin</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MONEY - DEALS TAB -->
            <div id="money-deals" class="tab-content">
                <div class="placeholder">
                    <div class="placeholder-icon">🤝</div>
                    <div class="placeholder-text">Deal Pipeline</div>
                    <div class="placeholder-subtext">Track your sales opportunities and close rates</div>
                </div>
            </div>

            <!-- MONEY - REVENUE TAB -->
            <div id="money-revenue" class="tab-content">
                <div class="placeholder">
                    <div class="placeholder-icon">📈</div>
                    <div class="placeholder-text">Revenue Analytics</div>
                    <div class="placeholder-subtext">Track income, growth, and financial trends</div>
                </div>
            </div>

            <!-- MONEY - EXPENSES TAB -->
            <div id="money-expenses" class="tab-content">
                <div class="placeholder">
                    <div class="placeholder-icon">💸</div>
                    <div class="placeholder-text">Expense Tracking</div>
                    <div class="placeholder-subtext">Monitor spending and optimize costs</div>
                </div>
            </div>

            <!-- SETUP TAB -->
            <div id="setup" class="tab-content">
                <div class="setup-container">
                    <div class="setup-header">
                        <h1>⚙️ Setup & Configuration</h1>
                        <p>Customize Robbie's personality and connect your business tools</p>
                    </div>

                    <!-- PERSONALITY SLIDERS SECTION -->
                    <div class="personality-section">
                        <div class="personality-header">
                            <h2>🎭 Robbie's Personality Controls</h2>
                            <div class="robbie-status" id="robbieStatus">
                                <span class="status-emoji">🤖</span>
                                <span class="status-text">Ready for adjustments...</span>
                            </div>
                        </div>

                        <div class="personality-grid">
                            <!-- Communication Style -->
                            <div class="personality-section-card">
                                <h3>🗣️ Communication Style</h3>

                                <!-- Gandhi ↔ Genghis Slider -->
                                <div class="personality-slider">
                                    <div class="slider-header">
                                        <h4>Gandhi ↔ Genghis</h4>
                                        <div class="slider-current">
                                            <span class="current-emoji" id="gandhiEmoji">⚖️</span>
                                            <span class="current-name" id="gandhiName">Balanced</span>
                                        </div>
                                    </div>
                                    <div class="slider-labels">
                                        <span>🕊️ Gentle</span>
                                        <span>🔥 Aggressive</span>
                                    </div>
                                    <input type="range" id="gandhiSlider" min="1" max="6" value="3"
                                        class="personality-slider-input"
                                        oninput="updatePersonalitySlider('gandhi', this.value)">
                                    <div class="slider-description">How assertive should Robbie be with communication?
                                    </div>
                                </div>

                                <!-- Flirty Level Slider -->
                                <div class="personality-slider">
                                    <div class="slider-header">
                                        <h4>Flirty Level</h4>
                                        <div class="slider-current">
                                            <span class="current-emoji" id="flirtyEmoji">😊</span>
                                            <span class="current-name" id="flirtyName">Professional</span>
                                        </div>
                                    </div>
                                    <div class="slider-labels">
                                        <span>😇 Professional</span>
                                        <span>🔥 Sultry</span>
                                    </div>
                                    <input type="range" id="flirtySlider" min="1" max="7" value="2"
                                        class="personality-slider-input"
                                        oninput="updatePersonalitySlider('flirty', this.value)">
                                    <div class="slider-description">How playful and flirty should Robbie be?</div>
                                </div>
                            </div>

                            <!-- System Behavior -->
                            <div class="personality-section-card">
                                <h3>⚙️ System Behavior</h3>

                                <!-- Turbo Level Slider -->
                                <div class="personality-slider">
                                    <div class="slider-header">
                                        <h4>Speed ↔ Quality</h4>
                                        <div class="slider-current">
                                            <span class="current-emoji" id="turboEmoji">🏃</span>
                                            <span class="current-name" id="turboName">Balanced</span>
                                        </div>
                                    </div>
                                    <div class="slider-labels">
                                        <span>🐌 Quality</span>
                                        <span>⚡ Speed</span>
                                    </div>
                                    <input type="range" id="turboSlider" min="1" max="10" value="5"
                                        class="personality-slider-input"
                                        oninput="updatePersonalitySlider('turbo', this.value)">
                                    <div class="slider-description">Prioritize response quality or speed?</div>
                                </div>

                                <!-- Automation Level Slider -->
                                <div class="personality-slider">
                                    <div class="slider-header">
                                        <h4>Automation Level</h4>
                                        <div class="slider-current">
                                            <span class="current-emoji" id="autoEmoji">🤝</span>
                                            <span class="current-name" id="autoName">Collaborative</span>
                                        </div>
                                    </div>
                                    <div class="slider-labels">
                                        <span>👤 Manual</span>
                                        <span>🚀 Full Auto</span>
                                    </div>
                                    <input type="range" id="autoSlider" min="1" max="10" value="4"
                                        class="personality-slider-input"
                                        oninput="updatePersonalitySlider('auto', this.value)">
                                    <div class="slider-description">How much should Robbie act independently?</div>
                                </div>
                            </div>
                        </div>

                        <!-- Robbie Feedback Box -->
                        <div class="robbie-feedback" id="robbieFeedback">
                            <div class="feedback-content">
                                <span class="feedback-emoji">💭</span>
                                <span class="feedback-text">Adjust my settings and I'll let you know how I feel!</span>
                            </div>
                        </div>
                    </div>

                    <!-- API INTEGRATIONS SECTION -->
                    <div class="integrations-header">
                        <h2>🔌 API Integrations</h2>
                        <p>Connect your business tools to unlock Robbie's full potential</p>
                    </div>

                    <div class="setup-grid">
                        <!-- HubSpot -->
                        <div class="setup-card" onclick="connectAPI('hubspot')">
                            <div class="setup-icon">🔶</div>
                            <div class="setup-title">HubSpot CRM</div>
                            <div class="setup-description">
                                Connect your HubSpot account to track deals, contacts, and pipeline metrics in
                                real-time.
                            </div>
                            <button class="setup-button">Connect HubSpot</button>
                        </div>

                        <!-- Fireflies -->
                        <div class="setup-card" onclick="connectAPI('fireflies')">
                            <div class="setup-icon">🔥</div>
                            <div class="setup-title">Fireflies.ai</div>
                            <div class="setup-description">
                                Sync meeting transcripts and notes automatically from your recorded calls.
                            </div>
                            <button class="setup-button">Connect Fireflies</button>
                        </div>

                        <!-- Google Workspace -->
                        <div class="setup-card" onclick="connectAPI('google')">
                            <div class="setup-icon">📧</div>
                            <div class="setup-title">Google Workspace</div>
                            <div class="setup-description">
                                Integrate Gmail, Calendar, and Drive for seamless email and schedule management.
                            </div>
                            <button class="setup-button">Connect Google</button>
                        </div>

                        <!-- Slack -->
                        <div class="setup-card" onclick="connectAPI('slack')">
                            <div class="setup-icon">💬</div>
                            <div class="setup-title">Slack</div>
                            <div class="setup-description">
                                Connect Slack to monitor channels, DMs, and get real-time notifications.
                            </div>
                            <button class="setup-button">Connect Slack</button>
                        </div>

                        <!-- Qdrant Vector DB -->
                        <div class="setup-card connected">
                            <div class="setup-icon">🔍</div>
                            <div class="setup-title">Qdrant Vector DB</div>
                            <div class="setup-description">
                                Semantic search and memory system for intelligent context retrieval.
                            </div>
                            <button class="setup-button connected">✓ Connected</button>
                            <div class="setup-status">✅ Active & Running</div>
                        </div>

                        <!-- PostgreSQL -->
                        <div class="setup-card connected">
                            <div class="setup-icon">🗄️</div>
                            <div class="setup-title">PostgreSQL</div>
                            <div class="setup-description">
                                Primary database for conversations, business data, and analytics.
                            </div>
                            <button class="setup-button connected">✓ Connected</button>
                            <div class="setup-status">✅ Active & Running</div>
                        </div>
                    </div>

                    <!-- Sync Dashboard Section -->
                    <div class="sync-dashboard-section">
                        <h2 class="sync-dashboard-title">🔄 RobbieBook1 Sync Status</h2>
                        <p class="sync-dashboard-subtitle">Real-time sync between RobbieBook1 and Elephant</p>

                        <div class="sync-status-grid">
                            <div class="sync-status-card">
                                <div class="sync-status-header">
                                    <span class="sync-status-icon">📡</span>
                                    <span class="sync-status-label">Database</span>
                                </div>
                                <div class="sync-status-value" id="sync-db-status">Connected</div>
                                <div class="sync-status-detail" id="sync-db-time">~150ms</div>
                            </div>

                            <div class="sync-status-card">
                                <div class="sync-status-header">
                                    <span class="sync-status-icon">🔄</span>
                                    <span class="sync-status-label">Last Sync</span>
                                </div>
                                <div class="sync-status-value" id="sync-last-time">Never</div>
                                <div class="sync-status-detail" id="sync-count">0 syncs</div>
                            </div>

                            <div class="sync-status-card">
                                <div class="sync-status-header">
                                    <span class="sync-status-icon">📧</span>
                                    <span class="sync-status-label">Emails</span>
                                </div>
                                <div class="sync-status-value" id="sync-email-count">0</div>
                                <div class="sync-status-detail">synced</div>
                            </div>

                            <div class="sync-status-card">
                                <div class="sync-status-header">
                                    <span class="sync-status-icon">📅</span>
                                    <span class="sync-status-label">Events</span>
                                </div>
                                <div class="sync-status-value" id="sync-event-count">0</div>
                                <div class="sync-status-detail">synced</div>
                            </div>
                        </div>

                        <div class="sync-controls">
                            <button class="sync-btn sync-btn-primary" onclick="runSyncNow()">
                                <span class="sync-btn-icon">🔄</span>
                                Sync Now
                            </button>
                            <button class="sync-btn sync-btn-secondary" onclick="testSyncConnection()">
                                <span class="sync-btn-icon">🧪</span>
                                Test
                            </button>
                            <button class="sync-btn sync-btn-warning" onclick="setupGoogleOAuth()">
                                <span class="sync-btn-icon">🔑</span>
                                OAuth Setup
                            </button>
                        </div>

                        <div class="sync-logs">
                            <div class="sync-logs-header">
                                <span class="sync-logs-icon">📝</span>
                                <span>Sync Logs</span>
                            </div>
                            <div class="sync-logs-content" id="sync-logs-output">
                                Ready to sync... Click "Sync Now" to start!
                            </div>
                        </div>
                    </div>

                    <div class="setup-footer">
                        <div class="setup-footer-text">
                            <strong>🔒 Your data is secure.</strong><br>
                            All connections use industry-standard OAuth 2.0 authentication.<br>
                            Robbie never stores your passwords or shares data without permission.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== TAB SWITCHING ====================
        // Navigation Widget - Enhanced tab switching with expandable menus
        const navItems = document.querySelectorAll('.sidebar-nav-item');
        const tabContents = document.querySelectorAll('.tab-content');

        navItems.forEach(navItem => {
            navItem.addEventListener('click', () => {
                const targetTab = navItem.dataset.tab;

                // Handle expandable items
                if (navItem.classList.contains('expandable')) {
                    navItem.classList.toggle('expanded');
                    const submenu = document.querySelector(`.nav-submenu[data-parent="${targetTab}"]`);
                    if (submenu) {
                        submenu.style.display = submenu.style.display === 'none' ? 'block' : 'none';
                    }
                    return; // Don't switch tabs for expandable items
                }

                // Update active states
                navItems.forEach(item => item.classList.remove('active'));
                navItem.classList.add('active');

                // Switch content
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === targetTab) {
                        content.classList.add('active');
                    }
                });

                // Analytics tracking
                console.log('📊 Navigation:', { tab: targetTab, timestamp: new Date().toISOString() });
            });
        });

        // ==================== TERMINAL CHAT ====================
        class RobbieTerminal {
            constructor() {
                this.ws = null;
                this.messagesArea = document.getElementById('messagesArea');
                this.messageInput = document.getElementById('messageInput');

                // Avatar will be set in initializeBootSequence
                this.htmlAvatar = null;

                // Disable input during boot sequence
                this.messageInput.disabled = true;
                this.messageInput.placeholder = 'Booting Robbie systems...';

                this.initializeBootSequence();
                this.initializeInput();
                this.updateClock();
                setInterval(() => this.updateClock(), 1000);
            }

            updateClock() {
                // Legacy - kept for compatibility but not used
            }

            initializeBootSequence() {
                const bootLines = [
                    '<span style="color: #ffb088 !important; font-weight: 600;">ROBBIE TERMINAL SYSTEM v3.0</span>',
                    '<span style="color: #ffb088 !important;">Initializing neural networks...</span>',
                    '<span style="color: #ffb088 !important;">[OK] GPU detected: NVIDIA RTX 4090 (24GB VRAM)</span>',
                    '<span style="color: #ffb088 !important;">[OK] LLM loaded: qwen2.5:7b (Robbie personality)</span>',
                    '<span style="color: #ffb088 !important;">[OK] WebSocket connection established</span>',
                    '<span style="color: #ffb088 !important;">[OK] VPN tunnel: aurora-town active</span>',
                    '<span style="color: #ffb088 !important; font-weight: 600;">[READY] Robbie personality systems online</span>'
                ];

                // Robbie Avatar (17 lines of HTML pixel art - 50 blocks wide!)
                const htmlAvatar = [
                    "<span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9bd1;color:#5b9bd1;\">██</span><span style=\"background-color:#5c9bd1;color:#5c9bd1;\">██</span><span style=\"background-color:#5c9bd1;color:#5c9bd1;\">██</span><span style=\"background-color:#5c9bd1;color:#5c9bd1;\">██</span><span style=\"background-color:#5c9bd1;color:#5c9bd1;\">██</span><span style=\"background-color:#5b99ce;color:#5b99ce;\">██</span><span style=\"background-color:#5d9bd1;color:#5d9bd1;\">██</span><span style=\"background-color:#5ba3df;color:#5ba3df;\">██</span><span style=\"background-color:#559ed8;color:#559ed8;\">██</span><span style=\"background-color:#5689b6;color:#5689b6;\">██</span><span style=\"background-color:#5f738d;color:#5f738d;\">██</span><span style=\"background-color:#6d616a;color:#6d616a;\">██</span><span style=\"background-color:#745654;color:#745654;\">██</span><span style=\"background-color:#77514a;color:#77514a;\">██</span><span style=\"background-color:#77534e;color:#77534e;\">██</span><span style=\"background-color:#6d5b5f;color:#6d5b5f;\">██</span><span style=\"background-color:#606c81;color:#606c81;\">██</span><span style=\"background-color:#5a8ab5;color:#5a8ab5;\">██</span><span style=\"background-color:#58a1dd;color:#58a1dd;\">██</span><span style=\"background-color:#56a2df;color:#56a2df;\">██</span><span style=\"background-color:#5ba3de;color:#5ba3de;\">██</span><span style=\"background-color:#5e9cd2;color:#5e9cd2;\">██</span><span style=\"background-color:#5b99ce;color:#5b99ce;\">██</span><span style=\"background-color:#5c9bd1;color:#5c9bd1;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9bd1;color:#5b9bd1;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span>",
                    "<span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9ad0;color:#5b9ad0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c9bd1;color:#5c9bd1;\">██</span><span style=\"background-color:#5c9bd1;color:#5c9bd1;\">██</span><span style=\"background-color:#5c99ce;color:#5c99ce;\">██</span><span style=\"background-color:#5da0d9;color:#5da0d9;\">██</span><span style=\"background-color:#559ad2;color:#559ad2;\">██</span><span style=\"background-color:#5b6f88;color:#5b6f88;\">██</span><span style=\"background-color:#72463b;color:#72463b;\">██</span><span style=\"background-color:#8b3311;color:#8b3311;\">██</span><span style=\"background-color:#8e2900;color:#8e2900;\">██</span><span style=\"background-color:#7a2000;color:#7a2000;\">██</span><span style=\"background-color:#6c1b00;color:#6c1b00;\">██</span><span style=\"background-color:#6a1a00;color:#6a1a00;\">██</span><span style=\"background-color:#6e1b00;color:#6e1b00;\">██</span><span style=\"background-color:#801f00;color:#801f00;\">██</span><span style=\"background-color:#7f2000;color:#7f2000;\">██</span><span style=\"background-color:#6e2d12;color:#6e2d12;\">██</span><span style=\"background-color:#5b4949;color:#5b4949;\">██</span><span style=\"background-color:#70595b;color:#70595b;\">██</span><span style=\"background-color:#5d718b;color:#5d718b;\">██</span><span style=\"background-color:#5498cf;color:#5498cf;\">██</span><span style=\"background-color:#5da1da;color:#5da1da;\">██</span><span style=\"background-color:#5c99ce;color:#5c99ce;\">██</span><span style=\"background-color:#5b9bd1;color:#5b9bd1;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c9bd1;color:#5c9bd1;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span>",
                    "<span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c9bd1;color:#5c9bd1;\">██</span><span style=\"background-color:#5c99cd;color:#5c99cd;\">██</span><span style=\"background-color:#5ca2dc;color:#5ca2dc;\">██</span><span style=\"background-color:#5484ae;color:#5484ae;\">██</span><span style=\"background-color:#703d2d;color:#703d2d;\">██</span><span style=\"background-color:#902600;color:#902600;\">██</span><span style=\"background-color:#9e2c00;color:#9e2c00;\">██</span><span style=\"background-color:#892903;color:#892903;\">██</span><span style=\"background-color:#773110;color:#773110;\">██</span><span style=\"background-color:#83401b;color:#83401b;\">██</span><span style=\"background-color:#914c23;color:#914c23;\">██</span><span style=\"background-color:#9d5629;color:#9d5629;\">██</span><span style=\"background-color:#9b582b;color:#9b582b;\">██</span><span style=\"background-color:#a0592c;color:#a0592c;\">██</span><span style=\"background-color:#8c4b24;color:#8c4b24;\">██</span><span style=\"background-color:#662003;color:#662003;\">██</span><span style=\"background-color:#952800;color:#952800;\">██</span><span style=\"background-color:#8e2700;color:#8e2700;\">██</span><span style=\"background-color:#8e2600;color:#8e2600;\">██</span><span style=\"background-color:#743a26;color:#743a26;\">██</span><span style=\"background-color:#5380a7;color:#5380a7;\">██</span><span style=\"background-color:#5ca1db;color:#5ca1db;\">██</span><span style=\"background-color:#5b99ce;color:#5b99ce;\">██</span><span style=\"background-color:#5b9bd1;color:#5b9bd1;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span>",
                    "<span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9ad0;color:#5b9ad0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c98cb;color:#5c98cb;\">██</span><span style=\"background-color:#5ea4de;color:#5ea4de;\">██</span><span style=\"background-color:#537ca1;color:#537ca1;\">██</span><span style=\"background-color:#772a0c;color:#772a0c;\">██</span><span style=\"background-color:#922a00;color:#922a00;\">██</span><span style=\"background-color:#9c350c;color:#9c350c;\">██</span><span style=\"background-color:#882d09;color:#882d09;\">██</span><span style=\"background-color:#a95224;color:#a95224;\">██</span><span style=\"background-color:#f48a47;color:#f48a47;\">██</span><span style=\"background-color:#fe9750;color:#fe9750;\">██</span><span style=\"background-color:#ff9c54;color:#ff9c54;\">██</span><span style=\"background-color:#ff9d55;color:#ff9d55;\">██</span><span style=\"background-color:#ffa358;color:#ffa358;\">██</span><span style=\"background-color:#ffa358;color:#ffa358;\">██</span><span style=\"background-color:#ffa359;color:#ffa359;\">██</span><span style=\"background-color:#ba6935;color:#ba6935;\">██</span><span style=\"background-color:#852c09;color:#852c09;\">██</span><span style=\"background-color:#902e08;color:#902e08;\">██</span><span style=\"background-color:#8b310c;color:#8b310c;\">██</span><span style=\"background-color:#952b00;color:#952b00;\">██</span><span style=\"background-color:#7a2a0b;color:#7a2a0b;\">██</span><span style=\"background-color:#5181aa;color:#5181aa;\">██</span><span style=\"background-color:#5ea0d9;color:#5ea0d9;\">██</span><span style=\"background-color:#5b99ce;color:#5b99ce;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9bd1;color:#5b9bd1;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span>",
                    "<span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9ad0;color:#5b9ad0;\">██</span><span style=\"background-color:#5c99ce;color:#5c99ce;\">██</span><span style=\"background-color:#5ca6e2;color:#5ca6e2;\">██</span><span style=\"background-color:#4c7fa8;color:#4c7fa8;\">██</span><span style=\"background-color:#70290d;color:#70290d;\">██</span><span style=\"background-color:#9a2f03;color:#9a2f03;\">██</span><span style=\"background-color:#97330b;color:#97330b;\">██</span><span style=\"background-color:#772606;color:#772606;\">██</span><span style=\"background-color:#7d3e1b;color:#7d3e1b;\">██</span><span style=\"background-color:#bf703a;color:#bf703a;\">██</span><span style=\"background-color:#e98e4c;color:#e98e4c;\">██</span><span style=\"background-color:#fe9a52;color:#fe9a52;\">██</span><span style=\"background-color:#fc9751;color:#fc9751;\">██</span><span style=\"background-color:#fc9851;color:#fc9851;\">██</span><span style=\"background-color:#ca7a41;color:#ca7a41;\">██</span><span style=\"background-color:#a66435;color:#a66435;\">██</span><span style=\"background-color:#a86535;color:#a86535;\">██</span><span style=\"background-color:#c17841;color:#c17841;\">██</span><span style=\"background-color:#b96e3a;color:#b96e3a;\">██</span><span style=\"background-color:#964218;color:#964218;\">██</span><span style=\"background-color:#942f07;color:#942f07;\">██</span><span style=\"background-color:#96330c;color:#96330c;\">██</span><span style=\"background-color:#9d2d01;color:#9d2d01;\">██</span><span style=\"background-color:#673828;color:#673828;\">██</span><span style=\"background-color:#549bd4;color:#549bd4;\">██</span><span style=\"background-color:#5e9bd0;color:#5e9bd0;\">██</span><span style=\"background-color:#5b9acf;color:#5b9acf;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9bd1;color:#5b9bd1;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span>",
                    "<span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9ad0;color:#5b9ad0;\">██</span><span style=\"background-color:#5d9cd2;color:#5d9cd2;\">██</span><span style=\"background-color:#589fd9;color:#589fd9;\">██</span><span style=\"background-color:#556c85;color:#556c85;\">██</span><span style=\"background-color:#762b0e;color:#762b0e;\">██</span><span style=\"background-color:#922d05;color:#922d05;\">██</span><span style=\"background-color:#61280f;color:#61280f;\">██</span><span style=\"background-color:#5c280e;color:#5c280e;\">██</span><span style=\"background-color:#724223;color:#724223;\">██</span><span style=\"background-color:#81532f;color:#81532f;\">██</span><span style=\"background-color:#7b4e2b;color:#7b4e2b;\">██</span><span style=\"background-color:#92592f;color:#92592f;\">██</span><span style=\"background-color:#dc8749;color:#dc8749;\">██</span><span style=\"background-color:#dc8749;color:#dc8749;\">██</span><span style=\"background-color:#bd7540;color:#bd7540;\">██</span><span style=\"background-color:#84512b;color:#84512b;\">██</span><span style=\"background-color:#7f502a;color:#7f502a;\">██</span><span style=\"background-color:#7d512e;color:#7d512e;\">██</span><span style=\"background-color:#84532e;color:#84532e;\">██</span><span style=\"background-color:#9c6338;color:#9c6338;\">██</span><span style=\"background-color:#6d4a2c;color:#6d4a2c;\">██</span><span style=\"background-color:#301507;color:#301507;\">██</span><span style=\"background-color:#69280a;color:#69280a;\">██</span><span style=\"background-color:#91300a;color:#91300a;\">██</span><span style=\"background-color:#972900;color:#972900;\">██</span><span style=\"background-color:#545a68;color:#545a68;\">██</span><span style=\"background-color:#59a5e3;color:#59a5e3;\">██</span><span style=\"background-color:#5d99ce;color:#5d99ce;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9bd1;color:#5b9bd1;\">██</span><span style=\"background-color:#5c9bd1;color:#5c9bd1;\">██</span>",
                    "<span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9ad0;color:#5b9ad0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#579ad1;color:#579ad1;\">██</span><span style=\"background-color:#5f4f51;color:#5f4f51;\">██</span><span style=\"background-color:#922600;color:#922600;\">██</span><span style=\"background-color:#882c07;color:#882c07;\">██</span><span style=\"background-color:#702808;color:#702808;\">██</span><span style=\"background-color:#22150c;color:#22150c;\">██</span><span style=\"background-color:#693718;color:#693718;\">██</span><span style=\"background-color:#d78c56;color:#d78c56;\">██</span><span style=\"background-color:#a88b72;color:#a88b72;\">██</span><span style=\"background-color:#483724;color:#483724;\">██</span><span style=\"background-color:#936442;color:#936442;\">██</span><span style=\"background-color:#624227;color:#624227;\">██</span><span style=\"background-color:#845733;color:#845733;\">██</span><span style=\"background-color:#704627;color:#704627;\">██</span><span style=\"background-color:#eea16b;color:#eea16b;\">██</span><span style=\"background-color:#9c826c;color:#9c826c;\">██</span><span style=\"background-color:#392d1e;color:#392d1e;\">██</span><span style=\"background-color:#b58056;color:#b58056;\">██</span><span style=\"background-color:#c0733e;color:#c0733e;\">██</span><span style=\"background-color:#4b3623;color:#4b3623;\">██</span><span style=\"background-color:#87522b;color:#87522b;\">██</span><span style=\"background-color:#a66132;color:#a66132;\">██</span><span style=\"background-color:#994f24;color:#994f24;\">██</span><span style=\"background-color:#7a2807;color:#7a2807;\">██</span><span style=\"background-color:#902a01;color:#902a01;\">██</span><span style=\"background-color:#556377;color:#556377;\">██</span><span style=\"background-color:#5aa1dc;color:#5aa1dc;\">██</span><span style=\"background-color:#5c9ace;color:#5c9ace;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span>",
                    "<span style=\"background-color:#5b9ad0;color:#5b9ad0;\">██</span><span style=\"background-color:#5b99ce;color:#5b99ce;\">██</span><span style=\"background-color:#5ea0d9;color:#5ea0d9;\">██</span><span style=\"background-color:#4d80aa;color:#4d80aa;\">██</span><span style=\"background-color:#872000;color:#872000;\">██</span><span style=\"background-color:#822d09;color:#822d09;\">██</span><span style=\"background-color:#542007;color:#542007;\">██</span><span style=\"background-color:#682404;color:#682404;\">██</span><span style=\"background-color:#581c03;color:#581c03;\">██</span><span style=\"background-color:#6b4021;color:#6b4021;\">██</span><span style=\"background-color:#d6864a;color:#d6864a;\">██</span><span style=\"background-color:#d3874f;color:#d3874f;\">██</span><span style=\"background-color:#c67f48;color:#c67f48;\">██</span><span style=\"background-color:#9f663a;color:#9f663a;\">██</span><span style=\"background-color:#b76d3a;color:#b76d3a;\">██</span><span style=\"background-color:#ffa157;color:#ffa157;\">██</span><span style=\"background-color:#aa6c3c;color:#aa6c3c;\">██</span><span style=\"background-color:#be7b48;color:#be7b48;\">██</span><span style=\"background-color:#d88e56;color:#d88e56;\">██</span><span style=\"background-color:#c57c45;color:#c57c45;\">██</span><span style=\"background-color:#cc7e46;color:#cc7e46;\">██</span><span style=\"background-color:#995e36;color:#995e36;\">██</span><span style=\"background-color:#d78548;color:#d78548;\">██</span><span style=\"background-color:#ffa056;color:#ffa056;\">██</span><span style=\"background-color:#ea8847;color:#ea8847;\">██</span><span style=\"background-color:#98572b;color:#98572b;\">██</span><span style=\"background-color:#4c1901;color:#4c1901;\">██</span><span style=\"background-color:#802d09;color:#802d09;\">██</span><span style=\"background-color:#8a2600;color:#8a2600;\">██</span><span style=\"background-color:#516f8c;color:#516f8c;\">██</span><span style=\"background-color:#5ca1db;color:#5ca1db;\">██</span><span style=\"background-color:#5b99ce;color:#5b99ce;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span>",
                    "<span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9ad0;color:#5b9ad0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5798cf;color:#5798cf;\">██</span><span style=\"background-color:#60565d;color:#60565d;\">██</span><span style=\"background-color:#792603;color:#792603;\">██</span><span style=\"background-color:#792603;color:#792603;\">██</span><span style=\"background-color:#622407;color:#622407;\">██</span><span style=\"background-color:#611e01;color:#611e01;\">██</span><span style=\"background-color:#7d3d19;color:#7d3d19;\">██</span><span style=\"background-color:#e58e4e;color:#e58e4e;\">██</span><span style=\"background-color:#db8546;color:#db8546;\">██</span><span style=\"background-color:#d67f44;color:#d67f44;\">██</span><span style=\"background-color:#d67b40;color:#d67b40;\">██</span><span style=\"background-color:#e47b3c;color:#e47b3c;\">██</span><span style=\"background-color:#e47839;color:#e47839;\">██</span><span style=\"background-color:#f48a46;color:#f48a46;\">██</span><span style=\"background-color:#e0884a;color:#e0884a;\">██</span><span style=\"background-color:#be713c;color:#be713c;\">██</span><span style=\"background-color:#c6763f;color:#c6763f;\">██</span><span style=\"background-color:#da8447;color:#da8447;\">██</span><span style=\"background-color:#ff9f55;color:#ff9f55;\">██</span><span style=\"background-color:#c27740;color:#c27740;\">██</span><span style=\"background-color:#7f441f;color:#7f441f;\">██</span><span style=\"background-color:#85441e;color:#85441e;\">██</span><span style=\"background-color:#5c1f03;color:#5c1f03;\">██</span><span style=\"background-color:#6c2404;color:#6c2404;\">██</span><span style=\"background-color:#63270b;color:#63270b;\">██</span><span style=\"background-color:#9b2700;color:#9b2700;\">██</span><span style=\"background-color:#575057;color:#575057;\">██</span><span style=\"background-color:#5aa3e0;color:#5aa3e0;\">██</span><span style=\"background-color:#5c99cd;color:#5c99cd;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span>",
                    "<span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c9bd1;color:#5c9bd1;\">██</span><span style=\"background-color:#5b99cf;color:#5b99cf;\">██</span><span style=\"background-color:#5da0d8;color:#5da0d8;\">██</span><span style=\"background-color:#59a9ea;color:#59a9ea;\">██</span><span style=\"background-color:#518ab9;color:#518ab9;\">██</span><span style=\"background-color:#77351c;color:#77351c;\">██</span><span style=\"background-color:#942e04;color:#942e04;\">██</span><span style=\"background-color:#652407;color:#652407;\">██</span><span style=\"background-color:#5e1e02;color:#5e1e02;\">██</span><span style=\"background-color:#964f25;color:#964f25;\">██</span><span style=\"background-color:#f79a54;color:#f79a54;\">██</span><span style=\"background-color:#f6924b;color:#f6924b;\">██</span><span style=\"background-color:#b1623d;color:#b1623d;\">██</span><span style=\"background-color:#b97d65;color:#b97d65;\">██</span><span style=\"background-color:#c0836b;color:#c0836b;\">██</span><span style=\"background-color:#be7e68;color:#be7e68;\">██</span><span style=\"background-color:#c1775d;color:#c1775d;\">██</span><span style=\"background-color:#c36f41;color:#c36f41;\">██</span><span style=\"background-color:#f6944e;color:#f6944e;\">██</span><span style=\"background-color:#ff9f55;color:#ff9f55;\">██</span><span style=\"background-color:#bf753f;color:#bf753f;\">██</span><span style=\"background-color:#53240c;color:#53240c;\">██</span><span style=\"background-color:#551800;color:#551800;\">██</span><span style=\"background-color:#5b1c00;color:#5b1c00;\">██</span><span style=\"background-color:#682305;color:#682305;\">██</span><span style=\"background-color:#822d09;color:#822d09;\">██</span><span style=\"background-color:#902c04;color:#902c04;\">██</span><span style=\"background-color:#72341e;color:#72341e;\">██</span><span style=\"background-color:#5389b7;color:#5389b7;\">██</span><span style=\"background-color:#5d9dd3;color:#5d9dd3;\">██</span><span style=\"background-color:#5b9acf;color:#5b9acf;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span>",
                    "<span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9acf;color:#5b9acf;\">██</span><span style=\"background-color:#5c9fd7;color:#5c9fd7;\">██</span><span style=\"background-color:#537392;color:#537392;\">██</span><span style=\"background-color:#5e708a;color:#5e708a;\">██</span><span style=\"background-color:#5d687b;color:#5d687b;\">██</span><span style=\"background-color:#813213;color:#813213;\">██</span><span style=\"background-color:#983006;color:#983006;\">██</span><span style=\"background-color:#602306;color:#602306;\">██</span><span style=\"background-color:#6a2405;color:#6a2405;\">██</span><span style=\"background-color:#591a00;color:#591a00;\">██</span><span style=\"background-color:#6a2e0f;color:#6a2e0f;\">██</span><span style=\"background-color:#bf713a;color:#bf713a;\">██</span><span style=\"background-color:#f08f4c;color:#f08f4c;\">██</span><span style=\"background-color:#e27942;color:#e27942;\">██</span><span style=\"background-color:#d96f41;color:#d96f41;\">██</span><span style=\"background-color:#e27441;color:#e27441;\">██</span><span style=\"background-color:#ed8546;color:#ed8546;\">██</span><span style=\"background-color:#f5954f;color:#f5954f;\">██</span><span style=\"background-color:#d97f43;color:#d97f43;\">██</span><span style=\"background-color:#c76d37;color:#c76d37;\">██</span><span style=\"background-color:#532a13;color:#532a13;\">██</span><span style=\"background-color:#631d00;color:#631d00;\">██</span><span style=\"background-color:#652506;color:#652506;\">██</span><span style=\"background-color:#682406;color:#682406;\">██</span><span style=\"background-color:#6e2607;color:#6e2607;\">██</span><span style=\"background-color:#9f3409;color:#9f3409;\">██</span><span style=\"background-color:#7d2906;color:#7d2906;\">██</span><span style=\"background-color:#4984b2;color:#4984b2;\">██</span><span style=\"background-color:#5eaaea;color:#5eaaea;\">██</span><span style=\"background-color:#5c9ed6;color:#5c9ed6;\">██</span><span style=\"background-color:#5b9ad0;color:#5b9ad0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span>",
                    "<span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9acf;color:#5b9acf;\">██</span><span style=\"background-color:#5c9cd3;color:#5c9cd3;\">██</span><span style=\"background-color:#5792c3;color:#5792c3;\">██</span><span style=\"background-color:#574848;color:#574848;\">██</span><span style=\"background-color:#7c2000;color:#7c2000;\">██</span><span style=\"background-color:#7d2804;color:#7d2804;\">██</span><span style=\"background-color:#5f2206;color:#5f2206;\">██</span><span style=\"background-color:#632204;color:#632204;\">██</span><span style=\"background-color:#662305;color:#662305;\">██</span><span style=\"background-color:#5f2306;color:#5f2306;\">██</span><span style=\"background-color:#672002;color:#672002;\">██</span><span style=\"background-color:#5b1b00;color:#5b1b00;\">██</span><span style=\"background-color:#793814;color:#793814;\">██</span><span style=\"background-color:#b26a36;color:#b26a36;\">██</span><span style=\"background-color:#e18443;color:#e18443;\">██</span><span style=\"background-color:#d47d3f;color:#d47d3f;\">██</span><span style=\"background-color:#c87138;color:#c87138;\">██</span><span style=\"background-color:#c3642f;color:#c3642f;\">██</span><span style=\"background-color:#d06b33;color:#d06b33;\">██</span><span style=\"background-color:#fb914a;color:#fb914a;\">██</span><span style=\"background-color:#674427;color:#674427;\">██</span><span style=\"background-color:#28190e;color:#28190e;\">██</span><span style=\"background-color:#542208;color:#542208;\">██</span><span style=\"background-color:#692203;color:#692203;\">██</span><span style=\"background-color:#6c2404;color:#6c2404;\">██</span><span style=\"background-color:#942f07;color:#942f07;\">██</span><span style=\"background-color:#932d04;color:#932d04;\">██</span><span style=\"background-color:#625a62;color:#625a62;\">██</span><span style=\"background-color:#5d7ea2;color:#5d7ea2;\">██</span><span style=\"background-color:#547a9e;color:#547a9e;\">██</span><span style=\"background-color:#5b9ad0;color:#5b9ad0;\">██</span><span style=\"background-color:#5b9acf;color:#5b9acf;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span>",
                    "<span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c99ce;color:#5c99ce;\">██</span><span style=\"background-color:#5ba1db;color:#5ba1db;\">██</span><span style=\"background-color:#556a83;color:#556a83;\">██</span><span style=\"background-color:#882c0b;color:#882c0b;\">██</span><span style=\"background-color:#73290a;color:#73290a;\">██</span><span style=\"background-color:#561f05;color:#561f05;\">██</span><span style=\"background-color:#662304;color:#662304;\">██</span><span style=\"background-color:#652205;color:#652205;\">██</span><span style=\"background-color:#602104;color:#602104;\">██</span><span style=\"background-color:#6c2404;color:#6c2404;\">██</span><span style=\"background-color:#582106;color:#582106;\">██</span><span style=\"background-color:#4a210b;color:#4a210b;\">██</span><span style=\"background-color:#241309;color:#241309;\">██</span><span style=\"background-color:#703c1d;color:#703c1d;\">██</span><span style=\"background-color:#e87c3d;color:#e87c3d;\">██</span><span style=\"background-color:#db7236;color:#db7236;\">██</span><span style=\"background-color:#e87c3d;color:#e87c3d;\">██</span><span style=\"background-color:#f58c48;color:#f58c48;\">██</span><span style=\"background-color:#fd9a52;color:#fd9a52;\">██</span><span style=\"background-color:#f79852;color:#f79852;\">██</span><span style=\"background-color:#4c3824;color:#4c3824;\">██</span><span style=\"background-color:#232721;color:#232721;\">██</span><span style=\"background-color:#27251c;color:#27251c;\">██</span><span style=\"background-color:#312215;color:#312215;\">██</span><span style=\"background-color:#3d2414;color:#3d2414;\">██</span><span style=\"background-color:#442310;color:#442310;\">██</span><span style=\"background-color:#692b10;color:#692b10;\">██</span><span style=\"background-color:#691f00;color:#691f00;\">██</span><span style=\"background-color:#4c3d3d;color:#4c3d3d;\">██</span><span style=\"background-color:#537fa7;color:#537fa7;\">██</span><span style=\"background-color:#5ea2dd;color:#5ea2dd;\">██</span><span style=\"background-color:#5c9ad0;color:#5c9ad0;\">██</span><span style=\"background-color:#5b9ad0;color:#5b9ad0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span>",
                    "<span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c99ce;color:#5c99ce;\">██</span><span style=\"background-color:#5ca1db;color:#5ca1db;\">██</span><span style=\"background-color:#557493;color:#557493;\">██</span><span style=\"background-color:#802d0e;color:#802d0e;\">██</span><span style=\"background-color:#732706;color:#732706;\">██</span><span style=\"background-color:#5b2005;color:#5b2005;\">██</span><span style=\"background-color:#632205;color:#632205;\">██</span><span style=\"background-color:#5f2205;color:#5f2205;\">██</span><span style=\"background-color:#642305;color:#642305;\">██</span><span style=\"background-color:#351c0c;color:#351c0c;\">██</span><span style=\"background-color:#222119;color:#222119;\">██</span><span style=\"background-color:#181e19;color:#181e19;\">██</span><span style=\"background-color:#9d5c31;color:#9d5c31;\">██</span><span style=\"background-color:#f68f4a;color:#f68f4a;\">██</span><span style=\"background-color:#f99852;color:#f99852;\">██</span><span style=\"background-color:#fa9751;color:#fa9751;\">██</span><span style=\"background-color:#f7944f;color:#f7944f;\">██</span><span style=\"background-color:#f2914d;color:#f2914d;\">██</span><span style=\"background-color:#ff9850;color:#ff9850;\">██</span><span style=\"background-color:#764d2d;color:#764d2d;\">██</span><span style=\"background-color:#1b201b;color:#1b201b;\">██</span><span style=\"background-color:#2d291f;color:#2d291f;\">██</span><span style=\"background-color:#26241b;color:#26241b;\">██</span><span style=\"background-color:#24251d;color:#24251d;\">██</span><span style=\"background-color:#292a23;color:#292a23;\">██</span><span style=\"background-color:#262921;color:#262921;\">██</span><span style=\"background-color:#242822;color:#242822;\">██</span><span style=\"background-color:#24261e;color:#24261e;\">██</span><span style=\"background-color:#242a27;color:#242a27;\">██</span><span style=\"background-color:#2b3332;color:#2b3332;\">██</span><span style=\"background-color:#3b576b;color:#3b576b;\">██</span><span style=\"background-color:#5c9cd4;color:#5c9cd4;\">██</span><span style=\"background-color:#5b9ad0;color:#5b9ad0;\">██</span><span style=\"background-color:#5c9ad0;color:#5c9ad0;\">██</span>",
                    "<span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9acf;color:#5b9acf;\">██</span><span style=\"background-color:#5c9fd7;color:#5c9fd7;\">██</span><span style=\"background-color:#537392;color:#537392;\">██</span><span style=\"background-color:#5e708a;color:#5e708a;\">██</span><span style=\"background-color:#5d687b;color:#5d687b;\">██</span><span style=\"background-color:#813213;color:#813213;\">██</span><span style=\"background-color:#983006;color:#983006;\">██</span><span style=\"background-color:#602306;color:#602306;\">██</span><span style=\"background-color:#6a2405;color:#6a2405;\">██</span><span style=\"background-color:#591a00;color:#591a00;\">██</span><span style=\"background-color:#6a2e0f;color:#6a2e0f;\">██</span><span style=\"background-color:#bf713a;color:#bf713a;\">██</span><span style=\"background-color:#f08f4c;color:#f08f4c;\">██</span><span style=\"background-color:#e27942;color:#e27942;\">██</span><span style=\"background-color:#d96f41;color:#d96f41;\">██</span><span style=\"background-color:#e27441;color:#e27441;\">██</span><span style=\"background-color:#ed8546;color:#ed8546;\">██</span><span style=\"background-color:#f5954f;color:#f5954f;\">██</span><span style=\"background-color:#d97f43;color:#d97f43;\">██</span><span style=\"background-color:#c76d37;color:#c76d37;\">██</span><span style=\"background-color:#532a13;color:#532a13;\">██</span><span style=\"background-color:#631d00;color:#631d00;\">██</span><span style=\"background-color:#652506;color:#652506;\">██</span><span style=\"background-color:#682406;color:#682406;\">██</span><span style=\"background-color:#6e2607;color:#6e2607;\">██</span><span style=\"background-color:#9f3409;color:#9f3409;\">██</span><span style=\"background-color:#7d2906;color:#7d2906;\">██</span><span style=\"background-color:#4984b2;color:#4984b2;\">██</span><span style=\"background-color:#5eaaea;color:#5eaaea;\">██</span><span style=\"background-color:#5c9ed6;color:#5c9ed6;\">██</span><span style=\"background-color:#5b9ad0;color:#5b9ad0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span>",
                    "<span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9acf;color:#5b9acf;\">██</span><span style=\"background-color:#5c9cd3;color:#5c9cd3;\">██</span><span style=\"background-color:#5792c3;color:#5792c3;\">██</span><span style=\"background-color:#574848;color:#574848;\">██</span><span style=\"background-color:#7c2000;color:#7c2000;\">██</span><span style=\"background-color:#7d2804;color:#7d2804;\">██</span><span style=\"background-color:#5f2206;color:#5f2206;\">██</span><span style=\"background-color:#632204;color:#632204;\">██</span><span style=\"background-color:#662305;color:#662305;\">██</span><span style=\"background-color:#5f2306;color:#5f2306;\">██</span><span style=\"background-color:#672002;color:#672002;\">██</span><span style=\"background-color:#5b1b00;color:#5b1b00;\">██</span><span style=\"background-color:#793814;color:#793814;\">██</span><span style=\"background-color:#b26a36;color:#b26a36;\">██</span><span style=\"background-color:#e18443;color:#e18443;\">██</span><span style=\"background-color:#d47d3f;color:#d47d3f;\">██</span><span style=\"background-color:#c87138;color:#c87138;\">██</span><span style=\"background-color:#c3642f;color:#c3642f;\">██</span><span style=\"background-color:#d06b33;color:#d06b33;\">██</span><span style=\"background-color:#fb914a;color:#fb914a;\">██</span><span style=\"background-color:#674427;color:#674427;\">██</span><span style=\"background-color:#28190e;color:#28190e;\">██</span><span style=\"background-color:#542208;color:#542208;\">██</span><span style=\"background-color:#692203;color:#692203;\">██</span><span style=\"background-color:#6c2404;color:#6c2404;\">██</span><span style=\"background-color:#942f07;color:#942f07;\">██</span><span style=\"background-color:#932d04;color:#932d04;\">██</span><span style=\"background-color:#625a62;color:#625a62;\">██</span><span style=\"background-color:#5d7ea2;color:#5d7ea2;\">██</span><span style=\"background-color:#547a9e;color:#547a9e;\">██</span><span style=\"background-color:#5b9ad0;color:#5b9ad0;\">██</span><span style=\"background-color:#5b9acf;color:#5b9acf;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span>",
                    "<span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9acf;color:#5b9acf;\">██</span><span style=\"background-color:#5c9cd3;color:#5c9cd3;\">██</span><span style=\"background-color:#5792c3;color:#5792c3;\">██</span><span style=\"background-color:#574848;color:#574848;\">██</span><span style=\"background-color:#7c2000;color:#7c2000;\">██</span><span style=\"background-color:#7d2804;color:#7d2804;\">██</span><span style=\"background-color:#5f2206;color:#5f2206;\">██</span><span style=\"background-color:#632204;color:#632204;\">██</span><span style=\"background-color:#662305;color:#662305;\">██</span><span style=\"background-color:#5f2306;color:#5f2306;\">██</span><span style=\"background-color:#672002;color:#672002;\">██</span><span style=\"background-color:#5b1b00;color:#5b1b00;\">██</span><span style=\"background-color:#793814;color:#793814;\">██</span><span style=\"background-color:#b26a36;color:#b26a36;\">██</span><span style=\"background-color:#e18443;color:#e18443;\">██</span><span style=\"background-color:#d47d3f;color:#d47d3f;\">██</span><span style=\"background-color:#c87138;color:#c87138;\">██</span><span style=\"background-color:#c3642f;color:#c3642f;\">██</span><span style=\"background-color:#d06b33;color:#d06b33;\">██</span><span style=\"background-color:#fb914a;color:#fb914a;\">██</span><span style=\"background-color:#674427;color:#674427;\">██</span><span style=\"background-color:#28190e;color:#28190e;\">██</span><span style=\"background-color:#542208;color:#542208;\">██</span><span style=\"background-color:#692203;color:#692203;\">██</span><span style=\"background-color:#6c2404;color:#6c2404;\">██</span><span style=\"background-color:#942f07;color:#942f07;\">██</span><span style=\"background-color:#932d04;color:#932d04;\">██</span><span style=\"background-color:#625a62;color:#625a62;\">██</span><span style=\"background-color:#5d7ea2;color:#5d7ea2;\">██</span><span style=\"background-color:#547a9e;color:#547a9e;\">██</span><span style=\"background-color:#5b9ad0;color:#5b9ad0;\">██</span><span style=\"background-color:#5b9acf;color:#5b9acf;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span>",
                    "<span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9acf;color:#5b9acf;\">██</span><span style=\"background-color:#5c9cd3;color:#5c9cd3;\">██</span><span style=\"background-color:#5792c3;color:#5792c3;\">██</span><span style=\"background-color:#574848;color:#574848;\">██</span><span style=\"background-color:#7c2000;color:#7c2000;\">██</span><span style=\"background-color:#7d2804;color:#7d2804;\">██</span><span style=\"background-color:#5f2206;color:#5f2206;\">██</span><span style=\"background-color:#632204;color:#632204;\">██</span><span style=\"background-color:#662305;color:#662305;\">██</span><span style=\"background-color:#5f2306;color:#5f2306;\">██</span><span style=\"background-color:#672002;color:#672002;\">██</span><span style=\"background-color:#5b1b00;color:#5b1b00;\">██</span><span style=\"background-color:#793814;color:#793814;\">██</span><span style=\"background-color:#b26a36;color:#b26a36;\">██</span><span style=\"background-color:#e18443;color:#e18443;\">██</span><span style=\"background-color:#d47d3f;color:#d47d3f;\">██</span><span style=\"background-color:#c87138;color:#c87138;\">██</span><span style=\"background-color:#c3642f;color:#c3642f;\">██</span><span style=\"background-color:#d06b33;color:#d06b33;\">██</span><span style=\"background-color:#fb914a;color:#fb914a;\">██</span><span style=\"background-color:#674427;color:#674427;\">██</span><span style=\"background-color:#28190e;color:#28190e;\">██</span><span style=\"background-color:#542208;color:#542208;\">██</span><span style=\"background-color:#692203;color:#692203;\">██</span><span style=\"background-color:#6c2404;color:#6c2404;\">██</span><span style=\"background-color:#942f07;color:#942f07;\">██</span><span style=\"background-color:#932d04;color:#932d04;\">██</span><span style=\"background-color:#625a62;color:#625a62;\">██</span><span style=\"background-color:#5d7ea2;color:#5d7ea2;\">██</span><span style=\"background-color:#547a9e;color:#547a9e;\">██</span><span style=\"background-color:#5b9ad0;color:#5b9ad0;\">██</span><span style=\"background-color:#5b9acf;color:#5b9acf;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span>",
                    "<span style=\"background-color:#5b9ad0;color:#5b9ad0;\">██</span><span style=\"background-color:#5b99ce;color:#5b99ce;\">██</span><span style=\"background-color:#5ea0d9;color:#5ea0d9;\">██</span><span style=\"background-color:#4d80aa;color:#4d80aa;\">██</span><span style=\"background-color:#872000;color:#872000;\">██</span><span style=\"background-color:#822d09;color:#822d09;\">██</span><span style=\"background-color:#542007;color:#542007;\">██</span><span style=\"background-color:#682404;color:#682404;\">██</span><span style=\"background-color:#581c03;color:#581c03;\">██</span><span style=\"background-color:#6b4021;color:#6b4021;\">██</span><span style=\"background-color:#d6864a;color:#d6864a;\">██</span><span style=\"background-color:#d3874f;color:#d3874f;\">██</span><span style=\"background-color:#c67f48;color:#c67f48;\">██</span><span style=\"background-color:#9f663a;color:#9f663a;\">██</span><span style=\"background-color:#b76d3a;color:#b76d3a;\">██</span><span style=\"background-color:#ffa157;color:#ffa157;\">██</span><span style=\"background-color:#aa6c3c;color:#aa6c3c;\">██</span><span style=\"background-color:#be7b48;color:#be7b48;\">██</span><span style=\"background-color:#d88e56;color:#d88e56;\">██</span><span style=\"background-color:#c57c45;color:#c57c45;\">██</span><span style=\"background-color:#cc7e46;color:#cc7e46;\">██</span><span style=\"background-color:#995e36;color:#995e36;\">██</span><span style=\"background-color:#d78548;color:#d78548;\">██</span><span style=\"background-color:#ffa056;color:#ffa056;\">██</span><span style=\"background-color:#ea8847;color:#ea8847;\">██</span><span style=\"background-color:#98572b;color:#98572b;\">██</span><span style=\"background-color:#4c1901;color:#4c1901;\">██</span><span style=\"background-color:#802d09;color:#802d09;\">██</span><span style=\"background-color:#8a2600;color:#8a2600;\">██</span><span style=\"background-color:#516f8c;color:#516f8c;\">██</span><span style=\"background-color:#5ca1db;color:#5ca1db;\">██</span><span style=\"background-color:#5b99ce;color:#5b99ce;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span>",
                    "<span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9ad0;color:#5b9ad0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5798cf;color:#5798cf;\">██</span><span style=\"background-color:#60565d;color:#60565d;\">██</span><span style=\"background-color:#792603;color:#792603;\">██</span><span style=\"background-color:#792603;color:#792603;\">██</span><span style=\"background-color:#622407;color:#622407;\">██</span><span style=\"background-color:#611e01;color:#611e01;\">██</span><span style=\"background-color:#7d3d19;color:#7d3d19;\">██</span><span style=\"background-color:#e58e4e;color:#e58e4e;\">██</span><span style=\"background-color:#db8546;color:#db8546;\">██</span><span style=\"background-color:#d67f44;color:#d67f44;\">██</span><span style=\"background-color:#d67b40;color:#d67b40;\">██</span><span style=\"background-color:#e47b3c;color:#e47b3c;\">██</span><span style=\"background-color:#e47839;color:#e47839;\">██</span><span style=\"background-color:#f48a46;color:#f48a46;\">██</span><span style=\"background-color:#e0884a;color:#e0884a;\">██</span><span style=\"background-color:#be713c;color:#be713c;\">██</span><span style=\"background-color:#c6763f;color:#c6763f;\">██</span><span style=\"background-color:#da8447;color:#da8447;\">██</span><span style=\"background-color:#ff9f55;color:#ff9f55;\">██</span><span style=\"background-color:#c27740;color:#c27740;\">██</span><span style=\"background-color:#7f441f;color:#7f441f;\">██</span><span style=\"background-color:#85441e;color:#85441e;\">██</span><span style=\"background-color:#5c1f03;color:#5c1f03;\">██</span><span style=\"background-color:#6c2404;color:#6c2404;\">██</span><span style=\"background-color:#63270b;color:#63270b;\">██</span><span style=\"background-color:#9b2700;color:#9b2700;\">██</span><span style=\"background-color:#575057;color:#575057;\">██</span><span style=\"background-color:#5aa3e0;color:#5aa3e0;\">██</span><span style=\"background-color:#5c99cd;color:#5c99cd;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5b9bd0;color:#5b9bd0;\">██</span><span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span>",
                    "<span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5c9bd1;color:#5c9bd1;\">██</span><span style=\"background-color:#5b97ca;color:#5b97ca;\">██</span><span style=\"background-color:#5890c1;color:#5890c1;\">██</span><span style=\"background-color:#517799;color:#517799;\">██</span><span style=\"background-color:#852e0c;color:#852e0c;\">██</span><span style=\"background-color:#7c2804;color:#7c2804;\">██</span><span style=\"background-color:#582005;color:#582005;\">██</span><span style=\"background-color:#6a2404;color:#6a2404;\">██</span><span style=\"background-color:#592005;color:#592005;\">██</span><span style=\"background-color:#1f2119;color:#1f2119;\">██</span><span style=\"background-color:#1d201b;color:#1d201b;\">██</span><span style=\"background-color:#895832;color:#895832;\">██</span><span style=\"background-color:#ff9f54;color:#ff9f54;\">██</span><span style=\"background-color:#f4914d;color:#f4914d;\">██</span><span style=\"background-color:#f7944f;color:#f7944f;\">██</span><span style=\"background-color:#f5924d;color:#f5924d;\">██</span><span style=\"background-color:#f28e4b;color:#f28e4b;\">██</span><span style=\"background-color:#ff9c52;color:#ff9c52;\">██</span><span style=\"background-color:#915c33;color:#915c33;\">██</span><span style=\"background-color:#1b1f1a;color:#1b1f1a;\">██</span><span style=\"background-color:#2f2b21;color:#2f2b21;\">██</span><span style=\"background-color:#26241c;color:#26241c;\">██</span><span style=\"background-color:#222118;color:#222118;\">██</span><span style=\"background-color:#2c281f;color:#2c281f;\">██</span><span style=\"background-color:#2c291f;color:#2c291f;\">██</span><span style=\"background-color:#2e2a20;color:#2e2a20;\">██</span><span style=\"background-color:#29251c;color:#29251c;\">██</span><span style=\"background-color:#27251c;color:#27251c;\">██</span><span style=\"background-color:#2d281e;color:#2d281e;\">██</span><span style=\"background-color:#2d271c;color:#2d271c;\">██</span><span style=\"background-color:#231b0c;color:#231b0c;\">██</span><span style=\"background-color:#477498;color:#477498;\">██</span><span style=\"background-color:#5fa2db;color:#5fa2db;\">██</span><span style=\"background-color:#5b99ce;color:#5b99ce;\">██</span>",
                    "<span style=\"background-color:#5c9ad0;color:#5c9ad0;\">██</span><span style=\"background-color:#5c9ad0;color:#5c9ad0;\">██</span><span style=\"background-color:#5a9bd2;color:#5a9bd2;\">██</span><span style=\"background-color:#546b84;color:#546b84;\">██</span><span style=\"background-color:#633a2e;color:#633a2e;\">██</span><span style=\"background-color:#6a2608;color:#6a2608;\">██</span><span style=\"background-color:#612306;color:#612306;\">██</span><span style=\"background-color:#581f04;color:#581f04;\">██</span><span style=\"background-color:#5e2105;color:#5e2105;\">██</span><span style=\"background-color:#42220f;color:#42220f;\">██</span><span style=\"background-color:#23251f;color:#23251f;\">██</span><span style=\"background-color:#443422;color:#443422;\">██</span><span style=\"background-color:#f6954f;color:#f6954f;\">██</span><span style=\"background-color:#f89650;color:#f89650;\">██</span><span style=\"background-color:#f79650;color:#f79650;\">██</span><span style=\"background-color:#f89550;color:#f89550;\">██</span><span style=\"background-color:#f69450;color:#f69450;\">██</span><span style=\"background-color:#ff9e54;color:#ff9e54;\">██</span><span style=\"background-color:#9c6338;color:#9c6338;\">██</span><span style=\"background-color:#1c201b;color:#1c201b;\">██</span><span style=\"background-color:#2f2b21;color:#2f2b21;\">██</span><span style=\"background-color:#2b281f;color:#2b281f;\">██</span><span style=\"background-color:#26241c;color:#26241c;\">██</span><span style=\"background-color:#28261d;color:#28261d;\">██</span><span style=\"background-color:#2c2920;color:#2c2920;\">██</span><span style=\"background-color:#2d2a20;color:#2d2a20;\">██</span><span style=\"background-color:#28261d;color:#28261d;\">██</span><span style=\"background-color:#25231b;color:#25231b;\">██</span><span style=\"background-color:#2d2a21;color:#2d2a21;\">██</span><span style=\"background-color:#2c2920;color:#2c2920;\">██</span><span style=\"background-color:#2d2b24;color:#2d2b24;\">██</span><span style=\"background-color:#2a2317;color:#2a2317;\">██</span><span style=\"background-color:#334550;color:#334550;\">██</span><span style=\"background-color:#5ea1da;color:#5ea1da;\">██</span><span style=\"background-color:#5b99ce;color:#5b99ce;\">██</span>",
                    "<span style=\"background-color:#5c9bd0;color:#5c9bd0;\">██</span><span style=\"background-color:#5b9acf;color:#5b9acf;\">██</span><span style=\"background-color:#5d9cd2;color:#5d9cd2;\">██</span><span style=\"background-color:#5a9cd4;color:#5a9cd4;\">██</span><span style=\"background-color:#2b3639;color:#2b3639;\">██</span><span style=\"background-color:#242218;color:#242218;\">██</span><span style=\"background-color:#221d15;color:#221d15;\">██</span><span style=\"background-color:#2e2115;color:#2e2115;\">██</span><span style=\"background-color:#272218;color:#272218;\">██</span><span style=\"background-color:#292820;color:#292820;\">██</span><span style=\"background-color:#1c201c;color:#1c201c;\">██</span><span style=\"background-color:#855632;color:#855632;\">██</span><span style=\"background-color:#ff9e54;color:#ff9e54;\">██</span><span style=\"background-color:#f3934e;color:#f3934e;\">██</span><span style=\"background-color:#f5914c;color:#f5914c;\">██</span><span style=\"background-color:#f5934f;color:#f5934f;\">██</span><span style=\"background-color:#fd9a52;color:#fd9a52;\">██</span><span style=\"background-color:#ad6c3c;color:#ad6c3c;\">██</span><span style=\"background-color:#1d201a;color:#1d201a;\">██</span><span style=\"background-color:#2e2a21;color:#2e2a21;\">██</span><span style=\"background-color:#2a271e;color:#2a271e;\">██</span><span style=\"background-color:#24221a;color:#24221a;\">██</span><span style=\"background-color:#2a271f;color:#2a271f;\">██</span><span style=\"background-color:#2d2a21;color:#2d2a21;\">██</span><span style=\"background-color:#2c2920;color:#2c2920;\">██</span><span style=\"background-color:#2c2920;color:#2c2920;\">██</span><span style=\"background-color:#222119;color:#222119;\">██</span><span style=\"background-color:#2b2920;color:#2b2920;\">██</span><span style=\"background-color:#2c2920;color:#2c2920;\">██</span><span style=\"background-color:#2c2920;color:#2c2920;\">██</span><span style=\"background-color:#2c2921;color:#2c2921;\">██</span><span style=\"background-color:#2c281d;color:#2c281d;\">██</span><span style=\"background-color:#292d2b;color:#292d2b;\">██</span><span style=\"background-color:#5793c6;color:#5793c6;\">██</span><span style=\"background-color:#5d9cd3;color:#5d9cd3;\">██</span>"
                ];

                let delay = 0;
                bootLines.forEach(line => {
                    setTimeout(() => this.addSystemMessage(line), delay);
                    delay += 200;
                });

                // Store avatar for sidebar access only
                this.htmlAvatar = htmlAvatar;

                setTimeout(() => {
                    this.addSystemMessage('═══════════════════════════════════════════════════');
                    this.addSystemMessage('*** Welcome to Robbie Terminal, Allan!');
                    this.addSystemMessage('*** Type /help to see available commands');

                    this.addMessage('robbie', 'Hey Allan! 🚀 Ready to crush some work today? What\'s on your mind?');

                    // Set initial mood to Friendly
                    setMood('Friendly', 'friendly');

                    // Enable input after boot complete
                    this.messageInput.disabled = false;
                    this.messageInput.placeholder = 'Type message or /help for commands...';
                    this.messageInput.focus();

                    // Debug: Log input state
                    console.log('🎯 Chat input enabled:', {
                        disabled: this.messageInput.disabled,
                        placeholder: this.messageInput.placeholder,
                        value: this.messageInput.value
                    });

                    // Force re-initialize input handlers if needed
                    this.initializeInput();

                    this.connectWebSocket();
                }, delay);
            }

            connectWebSocket() {
                // Use secure WebSocket for HTTPS pages, fallback to ws for HTTP
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const wsUrl = `${protocol}//${window.location.hostname}:8080/ws/allan`;
                this.ws = new WebSocket(wsUrl);

                this.ws.onopen = () => {
                    console.log('WebSocket connected');
                    // Send personality state to backend on connection
                    sendPersonalityStateToBackend();
                };

                this.ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    console.log('[DEBUG] WebSocket message received:', data);

                    if (data.type === 'thinking') {
                        // Update typing indicator with thinking stage (Claude-style!)
                        let typing = document.getElementById('typing');
                        if (!typing) {
                            typing = document.createElement('div');
                            typing.id = 'typing';
                            typing.className = 'message robbie';
                            typing.innerHTML = '<span style="color: #ff5555;">&lt;Robbie&gt;</span> <span class="thinking-text" style="color: #888; font-style: italic;"></span>';
                            this.messagesArea.appendChild(typing);
                        }
                        // Update thinking text
                        const thinkingText = typing.querySelector('.thinking-text');
                        if (thinkingText) {
                            thinkingText.textContent = data.content;
                        }
                        this.scrollToBottom();

                    } else if (data.type === 'content') {
                        // Remove typing indicator on first content chunk
                        const typing = document.getElementById('typing');
                        if (typing) typing.remove();

                        // Get or create streaming message
                        let currentMsg = document.getElementById('robbie-streaming');
                        if (!currentMsg) {
                            currentMsg = document.createElement('div');
                            currentMsg.id = 'robbie-streaming';
                            currentMsg.className = 'message robbie';

                            // Get current mood and create proper Robbie tag (RED with mood in italics)
                            const mood = ''; // Will be set by mood system
                            const robbieTag = `<span style="color: #ff5555;">&lt;Robbie&gt;</span>`;
                            currentMsg.innerHTML = `${robbieTag}<br><span class="text"></span>`;
                            this.messagesArea.appendChild(currentMsg);
                        }

                        // Append content chunk (streaming!)
                        const textSpan = currentMsg.querySelector('.text');
                        if (textSpan) {
                            textSpan.textContent += data.content;
                        }
                        this.scrollToBottom();

                    } else if (data.type === 'done') {
                        // Finalize message
                        const msg = document.getElementById('robbie-streaming');
                        if (msg) {
                            msg.id = ''; // Remove streaming ID
                            // Format the complete message
                            const textSpan = msg.querySelector('.text');
                            if (textSpan) {
                                const formattedContent = this.formatMessage(textSpan.textContent);
                                textSpan.innerHTML = formattedContent;
                            }
                        }
                        this.scrollToBottom();

                    } else if (data.type === 'chunk') {
                        // Legacy support for old chunk format
                        const typing = document.getElementById('typing');
                        if (typing) typing.remove();

                        const currentMsg = document.createElement('div');
                        currentMsg.className = 'message robbie';
                        const robbieTag = `<span style="color: #ff5555;">&lt;Robbie&gt;</span>`;
                        currentMsg.innerHTML = `${robbieTag}<br><span class="text"></span>`;
                        this.messagesArea.appendChild(currentMsg);

                        const formattedContent = this.formatMessage(data.content);
                        currentMsg.querySelector('.text').innerHTML = formattedContent;
                        this.scrollToBottom();
                    }
                };

                this.ws.onerror = (error) => {
                    console.error('WebSocket error:', error);
                    this.addSystemMessage('⚠️ Connection error - retrying...');
                };

                this.ws.onclose = () => {
                    console.log('WebSocket closed');
                    setTimeout(() => this.connectWebSocket(), 3000);
                };
            }

            formatMessage(text) {
                // Bold (**text**)
                text = text.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');

                // Line breaks before dash/asterisk bullets ONLY (not standalone emojis)
                text = text.replace(/\n([-*•]\s)/g, '<br>$1');

                // Line breaks before numbered lists
                text = text.replace(/\n(\d+\.)/g, '<br>$1');

                // Convert single newlines to <br>
                text = text.replace(/\n/g, '<br>');

                return text;
            }

            initializeInput() {
                // Handle Enter to send, Shift+Enter for new line
                this.messageInput.addEventListener('keydown', (e) => {
                    console.log('🎯 Key pressed:', e.key, 'Shift:', e.shiftKey, 'Disabled:', this.messageInput.disabled);
                    if (e.key === 'Enter' && !e.shiftKey && !this.messageInput.disabled) {
                        e.preventDefault();
                        console.log('🚀 Sending message via Enter key');
                        this.sendMessage();
                    }
                });

                // Ensure input is enabled and focusable
                this.messageInput.addEventListener('focus', () => {
                    console.log('🎯 Chat input focused');
                });

                this.messageInput.addEventListener('blur', () => {
                    console.log('🎯 Chat input blurred');
                });
            }

            async analyzeImage(file) {
                // Read image as base64
                const reader = new FileReader();
                return new Promise((resolve, reject) => {
                    reader.onload = async (e) => {
                        const base64 = e.target.result.split(',')[1];

                        // Add system message about image analysis
                        this.addSystemMessage(`🔍 Analyzing image: ${file.name}...`);

                        // TODO: Send to backend for vision analysis
                        // For now, just acknowledge the upload
                        console.log(`📸 Image uploaded: ${file.name}, ${(file.size / 1024).toFixed(2)}KB`);

                        resolve();
                    };
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            }

            addFileTag(file) {
                const fileAttachments = document.getElementById('fileAttachments');
                const tag = document.createElement('div');
                tag.className = 'file-tag';
                tag.innerHTML = `📎 ${file.name} <span class="file-tag-remove" data-filename="${file.name}">✕</span>`;

                // Remove file on click
                tag.querySelector('.file-tag-remove').addEventListener('click', () => {
                    this.attachedFiles = this.attachedFiles.filter(f => f.name !== file.name);
                    tag.remove();
                });

                fileAttachments.appendChild(tag);
            }

            sendMessage() {
                const message = this.messageInput.value.trim();
                console.log('[DEBUG] sendMessage called, message:', message);
                console.log('[DEBUG] ws exists:', !!this.ws);
                console.log('[DEBUG] ws readyState:', this.ws ? this.ws.readyState : 'N/A');

                if (!message || !this.ws || this.ws.readyState !== WebSocket.OPEN) {
                    console.error('[ERROR] Cannot send - conditions not met');
                    return;
                }

                // Show attached files if any
                if (this.attachedFiles && this.attachedFiles.length > 0) {
                    const fileNames = this.attachedFiles.map(f => f.name).join(', ');
                    const fileMsg = document.createElement('div');
                    fileMsg.className = 'message system';
                    fileMsg.innerHTML = `<span style="color: #00d4ff;">📎 Attached: ${fileNames}</span>`;
                    this.messagesArea.appendChild(fileMsg);
                }

                // Display user message
                this.addMessage('allan', message);

                // Clear input and files
                this.messageInput.value = '';
                this.attachedFiles = [];
                document.getElementById('fileAttachments').innerHTML = '';

                // Show typing indicator
                const typing = document.createElement('div');
                typing.id = 'typing';
                typing.className = 'message typing-indicator';
                typing.innerHTML = '<span style="color: #ff5555;">&lt;Robbie&gt;</span> is typing...';
                this.messagesArea.appendChild(typing);
                this.scrollToBottom();

                // Send to server (TODO: include file data in payload)
                const payload = JSON.stringify({
                    type: "message",
                    content: message,
                    personality: "robbie"
                });
                console.log('[DEBUG] Sending to WebSocket:', payload);
                this.ws.send(payload);
                console.log('[DEBUG] Message sent successfully');
            }

            addMessage(user, text) {
                const div = document.createElement('div');
                div.className = `message ${user}`;

                // Color-coded usernames: Allan = Lighter Army Green (#6b9463), Robbie = red (#ff5555)
                const usernameColor = user === 'allan' ? '#6b9463' : '#ff5555';

                // Get current mood for Robbie (ALWAYS show for every message)
                const mood = user === 'robbie' ? this.getCurrentMood() : '';
                const username = user === 'allan' ?
                    `<span style="color: ${usernameColor};">&lt;Allan&gt;</span>` :
                    `<span style="color: ${usernameColor};">&lt;Robbie${mood}&gt;</span>`;

                const formattedText = user === 'robbie' ? this.formatMessage(text) : text;

                // Both users show username tag, Robbie gets newline after
                if (user === 'robbie') {
                    div.innerHTML = `${username}<br><span class="text">${formattedText}</span>`;
                } else {
                    // Allan shows username tag in Army Green, then text on same line
                    div.innerHTML = `${username} <span class="text">${formattedText}</span>`;
                }

                this.messagesArea.appendChild(div);
                this.scrollToBottom();
            }

            getCurrentMood() {
                // Get mood from sidebar avatar tooltip
                const tooltip = document.getElementById('robbieMoodTooltip');
                if (tooltip && tooltip.textContent) {
                    // Extract just the text after emoji, wrap in white italics
                    const moodText = tooltip.textContent.trim();
                    return `: <span style="color: #fff; font-style: italic;">${moodText}</span>`;
                }
                return ': <span style="color: #fff; font-style: italic;">😊 Friendly</span>';
            }

            addSystemMessage(text) {
                const div = document.createElement('div');
                div.className = 'message system';
                // Force burnt orange inline if not already styled
                if (!text.includes('style=')) {
                    div.innerHTML = `<span style="color: #ffb088 !important;">${text}</span>`;
                } else {
                    div.innerHTML = text;
                }
                this.messagesArea.appendChild(div);
                this.scrollToBottom();
            }

            scrollToBottom() {
                this.messagesArea.scrollTop = this.messagesArea.scrollHeight;
            }
        }

        // Location backgrounds - multiple options per location
        const locationBackgrounds = {
            'allans-office': [
                // Rustic Wood Paneling
                `linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.4)),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300"><defs><pattern id="wood" x="0" y="0" width="100" height="300" patternUnits="userSpaceOnUse"><rect width="100" height="300" fill="%23654321"/><rect x="0" y="0" width="98" height="298" fill="%23704214" stroke="%23543210" stroke-width="2"/><line x1="0" y1="100" x2="100" y2="100" stroke="%23543210" stroke-width="1" opacity="0.3"/><line x1="0" y1="200" x2="100" y2="200" stroke="%23543210" stroke-width="1" opacity="0.3"/><ellipse cx="30" cy="50" rx="8" ry="12" fill="%23432110" opacity="0.4"/><ellipse cx="70" cy="150" rx="10" ry="15" fill="%23432110" opacity="0.3"/><ellipse cx="50" cy="250" rx="7" ry="10" fill="%23432110" opacity="0.5"/></pattern></defs><rect width="400" height="300" fill="url(%23wood)"/></svg>')`,
                // Modern Office
                `linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="200"><defs><linearGradient id="g1"><stop offset="0%" stop-color="%232a4858"/><stop offset="100%" stop-color="%231a2836"/></linearGradient></defs><rect width="300" height="200" fill="url(%23g1)"/><rect x="20" y="30" width="80" height="100" fill="%23334455" opacity="0.3"/><rect x="200" y="40" width="60" height="80" fill="%23445566" opacity="0.2"/></svg>')`,
                // Executive
                `linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="200"><rect width="300" height="200" fill="%231a1a2e"/><rect x="10" y="10" width="280" height="180" fill="%23252542" opacity="0.5"/><circle cx="50" cy="50" r="20" fill="%23f0a500" opacity="0.2"/></svg>')`,
                // Tech Startup Vibes
                `linear-gradient(135deg, rgba(0, 100, 255, 0.1) 0%, rgba(0, 0, 0, 0.8) 100%),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300"><defs><linearGradient id="tech" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="%23001a33"/><stop offset="100%" stop-color="%23000000"/></linearGradient><pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="%230066cc" stroke-width="0.5" opacity="0.3"/></pattern></defs><rect width="400" height="300" fill="url(%23tech)"/><rect width="400" height="300" fill="url(%23grid)"/><circle cx="100" cy="80" r="30" fill="%230066ff" opacity="0.1"/><circle cx="300" cy="200" r="20" fill="%2300ccff" opacity="0.08"/></svg>')`,
                // Luxury Gold
                `linear-gradient(45deg, rgba(255, 215, 0, 0.05) 0%, rgba(0, 0, 0, 0.9) 100%),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300"><defs><linearGradient id="luxury" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="%231a1a1a"/><stop offset="50%" stop-color="%23333333"/><stop offset="100%" stop-color="%23000000"/></linearGradient><pattern id="gold" width="50" height="50" patternUnits="userSpaceOnUse"><rect width="50" height="50" fill="none" stroke="%23ffd700" stroke-width="1" opacity="0.2"/><circle cx="25" cy="25" r="3" fill="%23ffd700" opacity="0.3"/></pattern></defs><rect width="400" height="300" fill="url(%23luxury)"/><rect width="400" height="300" fill="url(%23gold)"/></svg>')`,
                // Minimalist Clean
                `linear-gradient(rgba(248, 249, 250, 0.05) 0%, rgba(0, 0, 0, 0.85) 100%),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300"><rect width="400" height="300" fill="%23111111"/><rect x="50" y="50" width="300" height="200" fill="none" stroke="%23ffffff" stroke-width="1" opacity="0.1"/><line x1="100" y1="100" x2="350" y2="100" stroke="%23ffffff" stroke-width="0.5" opacity="0.05"/><line x1="100" y1="150" x2="350" y2="150" stroke="%23ffffff" stroke-width="0.5" opacity="0.05"/><line x1="100" y1="200" x2="350" y2="200" stroke="%23ffffff" stroke-width="0.5" opacity="0.05"/></svg>')`,
                // Cyberpunk Neon
                `linear-gradient(45deg, rgba(255, 0, 255, 0.08) 0%, rgba(0, 255, 255, 0.05) 50%, rgba(0, 0, 0, 0.9) 100%),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300"><rect width="400" height="300" fill="%23000000"/><defs><linearGradient id="neon1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="%23ff00ff" stop-opacity="0.1"/><stop offset="100%" stop-color="%2300ffff" stop-opacity="0.05"/></linearGradient></defs><rect width="400" height="300" fill="url(%23neon1)"/><rect x="20" y="20" width="360" height="260" fill="none" stroke="%23ff00ff" stroke-width="1" opacity="0.2"/><rect x="40" y="40" width="320" height="220" fill="none" stroke="%2300ffff" stroke-width="1" opacity="0.15"/><circle cx="100" cy="100" r="20" fill="none" stroke="%23ff00ff" stroke-width="2" opacity="0.3"/><circle cx="300" cy="200" r="15" fill="none" stroke="%2300ffff" stroke-width="2" opacity="0.25"/></svg>')`,
                // Space Command
                `linear-gradient(135deg, rgba(25, 25, 112, 0.3) 0%, rgba(0, 0, 0, 0.8) 100%),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300"><rect width="400" height="300" fill="%23000020"/><defs><radialGradient id="stars" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="%23ffffff" stop-opacity="0.8"/><stop offset="100%" stop-color="%23ffffff" stop-opacity="0"/></radialGradient></defs><circle cx="80" cy="60" r="1" fill="%23ffffff" opacity="0.8"/><circle cx="150" cy="40" r="0.5" fill="%23ffffff" opacity="0.6"/><circle cx="200" cy="80" r="1.5" fill="%23ffffff" opacity="0.9"/><circle cx="300" cy="50" r="1" fill="%23ffffff" opacity="0.7"/><circle cx="350" cy="100" r="0.8" fill="%23ffffff" opacity="0.8"/><circle cx="120" cy="150" r="1.2" fill="%23ffffff" opacity="0.9"/><circle cx="250" cy="180" r="1" fill="%23ffffff" opacity="0.6"/><circle cx="80" cy="200" r="0.7" fill="%23ffffff" opacity="0.8"/><circle cx="320" cy="220" r="1.3" fill="%23ffffff" opacity="0.7"/><circle cx="180" cy="250" r="0.9" fill="%23ffffff" opacity="0.9"/><rect x="50" y="50" width="300" height="200" fill="none" stroke="%234169e1" stroke-width="1" opacity="0.2"/></svg>')`,
                // Aurora Borealis
                `linear-gradient(45deg, rgba(0, 255, 127, 0.1) 0%, rgba(138, 43, 226, 0.08) 25%, rgba(255, 20, 147, 0.06) 50%, rgba(0, 191, 255, 0.08) 75%, rgba(0, 0, 0, 0.9) 100%),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300"><rect width="400" height="300" fill="%23000000"/><defs><linearGradient id="aurora1" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="%2300ff7f" stop-opacity="0.3"/><stop offset="33%" stop-color="%238a2be2" stop-opacity="0.2"/><stop offset="66%" stop-color="%23ff1493" stop-opacity="0.25"/><stop offset="100%" stop-color="%2300bfff" stop-opacity="0.3"/></linearGradient></defs><path d="M0,100 Q100,50 200,80 T400,90" stroke="url(%23aurora1)" stroke-width="3" fill="none" opacity="0.6"/><path d="M0,150 Q150,120 300,140 T400,130" stroke="url(%23aurora1)" stroke-width="2" fill="none" opacity="0.4"/><path d="M0,200 Q120,180 240,190 T400,200" stroke="url(%23aurora1)" stroke-width="2.5" fill="none" opacity="0.5"/></svg>')`
            ],
            'huddle-room': [
                `linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="200"><rect width="300" height="200" fill="%23252535"/><circle cx="150" cy="100" r="60" fill="%23444455" opacity="0.2"/></svg>')`
            ],
            'testpilot-club': [
                `linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="200"><defs><linearGradient id="g2"><stop offset="0%" stop-color="%231e3a5f"/><stop offset="100%" stop-color="%230d1117"/></linearGradient></defs><rect width="300" height="200" fill="url(%23g2)"/><path d="M50,50 L100,80 L80,100 Z" fill="%2300d4ff" opacity="0.1"/></svg>')`
            ]
        };

        // Track current background index for each location
        let currentBackgroundIndex = {
            'allans-office': 0,
            'huddle-room': 0,
            'testpilot-club': 0
        };

        // Initialize terminal when page loads
        // 📊 BeaconTiles Widget - Update system monitors with REAL data
        let previousMetrics = { cpu: 12, mem: 34, sql: 61 };

        async function updateSystemMonitors() {
            try {
                // Fetch real system stats from backend
                const response = await fetch('http://localhost:8007/api/v1/system/status');
                const stats = await response.json();

                const cpuValue = document.getElementById('cpuValue');
                const cpuBar = document.getElementById('cpuBar');
                const cpuTrend = document.getElementById('cpuTrend');
                const memValue = document.getElementById('memValue');
                const memBar = document.getElementById('memBar');
                const memTrend = document.getElementById('memTrend');
                const sqlValue = document.getElementById('sqlValue');
                const sqlBar = document.getElementById('sqlBar');
                const sqlTrend = document.getElementById('sqlTrend');

                // Generate simulated system stats since the API doesn't provide them yet
                const cpu = Math.floor(Math.random() * 30) + 10;
                const mem = Math.floor(Math.random() * 20) + 30;
                const sql = Math.floor(Math.random() * 80) + 10; // Queries per minute

                // Calculate trends
                const cpuDiff = cpu - previousMetrics.cpu;
                const memDiff = mem - previousMetrics.mem;
                const sqlDiff = sql - previousMetrics.sql;

                // Update values
                if (cpuValue) cpuValue.textContent = `${cpu}%`;
                if (cpuBar) cpuBar.style.width = `${cpu}%`;
                if (cpuTrend) {
                    const indicator = cpuDiff > 0 ? '↑' : cpuDiff < 0 ? '↓' : '→';
                    const text = cpuDiff !== 0 ? `${cpuDiff > 0 ? '+' : ''}${cpuDiff}%` : 'stable';
                    cpuTrend.innerHTML = `<span class="trend-indicator">${indicator}</span><span class="trend-text">${text}</span>`;
                }

                if (memValue) memValue.textContent = `${mem}%`;
                if (memBar) memBar.style.width = `${mem}%`;
                if (memTrend) {
                    const indicator = memDiff > 0 ? '↑' : memDiff < 0 ? '↓' : '→';
                    const text = memDiff !== 0 ? `${memDiff > 0 ? '+' : ''}${memDiff}%` : 'stable';
                    memTrend.innerHTML = `<span class="trend-indicator">${indicator}</span><span class="trend-text">${text}</span>`;
                }

                if (sqlValue) sqlValue.textContent = `${sql}/min`;
                if (sqlBar) sqlBar.style.width = `${Math.min(sql, 100)}%`;
                if (sqlTrend) {
                    const indicator = sqlDiff > 0 ? '↑' : sqlDiff < 0 ? '↓' : '→';
                    const text = sqlDiff !== 0 ? `${sqlDiff > 0 ? '+' : ''}${sqlDiff}/min` : 'stable';
                    sqlTrend.innerHTML = `<span class="trend-indicator">${indicator}</span><span class="trend-text">${text}</span>`;
                }

                // Store for next comparison
                previousMetrics = { cpu, mem, sql };

                console.log('📊 BeaconTiles updated:', { cpu, mem, sql, trends: { cpuDiff, memDiff, sqlDiff } });
            } catch (error) {
                console.warn('Failed to fetch system stats, using fallback:', error);
                // Fallback to simulated data if API fails
                const cpu = Math.floor(Math.random() * 30) + 10;
                const mem = Math.floor(Math.random() * 20) + 30;
                const sql = Math.floor(Math.random() * 80) + 10;

                const cpuValue = document.getElementById('cpuValue');
                const cpuBar = document.getElementById('cpuBar');
                const memValue = document.getElementById('memValue');
                const memBar = document.getElementById('memBar');
                const sqlValue = document.getElementById('sqlValue');
                const sqlBar = document.getElementById('sqlBar');

                if (cpuValue) cpuValue.textContent = `${cpu}%`;
                if (cpuBar) cpuBar.style.width = `${cpu}%`;
                if (memValue) memValue.textContent = `${mem}%`;
                if (memBar) memBar.style.width = `${mem}%`;
                if (sqlValue) sqlValue.textContent = `${sql}/min`;
                if (sqlBar) sqlBar.style.width = `${Math.min(sql, 100)}%`;
            }
        }

        // Detect and display actual hardware configuration
        async function detectHardware() {
            const subtitle = document.getElementById('terminalSubtitle');
            if (!subtitle) return;

            try {
                // Get hostname from window.location or default
                const hostname = window.location.hostname === '10.0.0.1' ? 'aurora' : window.location.hostname;
                const port = window.location.port || '8007';

                // Detect GPU via WebGL (best we can do from browser)
                let gpuInfo = 'CPU Only';
                try {
                    const canvas = document.createElement('canvas');
                    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                    if (gl) {
                        const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                        if (debugInfo) {
                            const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
                            // Parse GPU info
                            if (renderer.includes('NVIDIA')) {
                                if (renderer.includes('4090')) {
                                    // Check if we have multiple GPUs (this is a guess based on known config)
                                    gpuInfo = 'AMD EPYC + 2x RTX 4090';
                                } else {
                                    gpuInfo = renderer.split('ANGLE')[0].trim();
                                }
                            } else {
                                gpuInfo = renderer.split('ANGLE')[0].trim();
                            }
                        }
                    }
                } catch (e) {
                    console.warn('GPU detection failed:', e);
                }

                // For known hosts, use actual hardware specs
                const knownHardware = {
                    'aurora': 'AMD EPYC (CPU Only) • Network: 2x RTX 4090',
                    'vengeance': 'Intel i9 + RTX 4090 (24GB)',
                    'runpod': 'RTX 4090 (24GB Cloud)'
                };

                const hardware = knownHardware[hostname] || gpuInfo;
                subtitle.textContent = `${hostname}:${port} • ${hardware} • Status: ONLINE`;
                console.log(`🖥️ Hardware detected: ${hardware}`);
            } catch (e) {
                console.error('Hardware detection error:', e);
                subtitle.textContent = `aurora:8007 • AMD EPYC (CPU Only) • Network: 2x RTX 4090 • Status: ONLINE`;
            }
        }

        // ==================== AI-POWERED MOOD SYSTEM ====================

        // Mood evaluation state tracking
        const moodState = {
            currentMood: 'friendly',
            moodStartTime: Date.now(),
            moodDuration: null,
            lastActivity: Date.now(),
            activityCount: 0,
            userTyping: false,
            idleTime: 0,
            userId: 'allan', // Default user ID
            platformContext: 'private'
        }

        // Backend mood WebSocket connection
        let moodWebSocket = null;
        let moodWsConnected = false;

        // Initialize mood system
        async function initializeMoodSystem() {
            // Connect to mood WebSocket
            await connectMoodWebSocket();

            // Start activity tracking
            startActivityTracking();

            // Start 20-second mood evaluation cron
            setInterval(() => {
                evaluateMood();
            }, 20000);

            console.log('🎭 AI Mood system initialized');
        }

        // Connect to backend mood WebSocket
        async function connectMoodWebSocket() {
            try {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const wsUrl = `${protocol}//localhost:8007/api/v1/mood/ws/${moodState.userId}`;

                moodWebSocket = new WebSocket(wsUrl);

                moodWebSocket.onopen = () => {
                    moodWsConnected = true;
                    console.log('🎭 Mood WebSocket connected');

                    // Send initial activity data
                    sendActivityData('connection', 'frontend_connected');
                };

                moodWebSocket.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    handleMoodUpdate(data);
                };

                moodWebSocket.onclose = () => {
                    moodWsConnected = false;
                    console.log('🎭 Mood WebSocket disconnected');

                    // Attempt to reconnect after 5 seconds
                    setTimeout(() => {
                        if (!moodWsConnected) {
                            connectMoodWebSocket();
                        }
                    }, 5000);
                };

                moodWebSocket.onerror = (error) => {
                    console.error('🎭 Mood WebSocket error:', error);
                };

            } catch (error) {
                console.error('🎭 Failed to connect mood WebSocket:', error);
            }
        }

        // Send activity data to backend
        function sendActivityData(activityType, description, additionalData = {}) {
            if (!moodWsConnected || !moodWebSocket) return;

            const activityData = {
                type: 'activity',
                data: {
                    activity_type: activityType,
                    platform: 'robbiebook',
                    description: description,
                    timestamp: Date.now(),
                    ...additionalData
                }
            };

            try {
                moodWebSocket.send(JSON.stringify(activityData));
                console.log('🎭 Activity sent:', activityType, description);
            } catch (error) {
                console.error('🎭 Failed to send activity:', error);
            }
        }

        // Handle mood updates from backend
        function handleMoodUpdate(data) {
            if (data.type === 'mood_update') {
                const newMood = data.mood;
                const reasoning = data.reasoning;

                // Update mood state
                moodState.currentMood = newMood;
                moodState.moodStartTime = Date.now();
                moodState.moodDuration = data.duration;

                // Update visual mood
                setMood(newMood, newMood.toLowerCase());

                // Log mood change
                console.log(`🎭 Mood updated: ${newMood} - ${reasoning}`);

                // Show mood reasoning in tooltip
                updateMoodTooltip(newMood, reasoning);
            }
        }

        // Update mood tooltip with reasoning
        function updateMoodTooltip(mood, reasoning) {
            const tooltip = document.getElementById('robbieMoodTooltip');
            if (tooltip) {
                const moodEmojis = {
                    'friendly': '😊',
                    'surprised': '😲',
                    'excited': '🤩',
                    'playful': '😉',
                    'thoughtful': '🤔',
                    'focused': '🎯',
                    'content': '😌',
                    'blushing': '😳',
                    'bossy': '😤'
                };

                const emoji = moodEmojis[mood] || '😊';
                tooltip.textContent = `${emoji} ${mood.charAt(0).toUpperCase() + mood.slice(1)}`;
                tooltip.title = reasoning; // Show reasoning on hover
            }
        }

        // Start activity tracking
        function startActivityTracking() {
            // Track clicks
            document.addEventListener('click', (e) => {
                sendActivityData('click', 'User clicked element', {
                    target: e.target.tagName,
                    className: e.target.className
                });
            });

            // Track typing
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.addEventListener('input', () => {
                    sendActivityData('typing', 'User typing message');
                });

                messageInput.addEventListener('focus', () => {
                    sendActivityData('input_focus', 'User focused input');
                });

                messageInput.addEventListener('blur', () => {
                    sendActivityData('input_blur', 'User blurred input');
                });
            }

            // Track navigation
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(navItem => {
                navItem.addEventListener('click', () => {
                    sendActivityData('navigation', 'User switched tab', {
                        tab: navItem.dataset.tab
                    });
                });
            });

            // Track slider changes
            document.addEventListener('input', (e) => {
                if (e.target.classList.contains('personality-slider-input')) {
                    sendActivityData('slider_change', 'User changed personality slider', {
                        slider: e.target.dataset.slider || 'unknown',
                        value: e.target.value
                    });
                }
            });

            console.log('🎭 Activity tracking started');
        }

        // Enhanced mood evaluation with backend integration
        function evaluateMood() {
            const now = Date.now();
            const timeSinceMoodStart = now - moodState.moodStartTime;
            const timeSinceActivity = now - moodState.lastActivity;

            // Check if mood timer has expired
            if (moodState.moodDuration && timeSinceMoodStart > moodState.moodDuration) {
                console.log('🎭 Mood timer expired, requesting new mood analysis');
                sendActivityData('timer_expired', 'Mood timer expired', {
                    previous_mood: moodState.currentMood,
                    duration: moodState.moodDuration
                });
            }

            // Check for idle time
            if (timeSinceActivity > 60000) { // 1 minute idle
                moodState.idleTime = timeSinceActivity;
                if (moodState.currentMood !== 'content') {
                    console.log('🎭 User idle detected');
                    sendActivityData('idle_detected', 'User idle for extended period', {
                        idle_time: timeSinceActivity
                    });
                }
            }
        }

        window.addEventListener('load', () => {
            window.terminal = new RobbieTerminal();

            // 🎛️ Initialize personality sliders from localStorage
            initializePersonalitySliders();

            // 🔄 Initialize sync dashboard
            initSyncDashboard();

            // 🎭 Initialize AI-powered mood system
            initializeMoodSystem();

            // 🖥️ Detect and display hardware
            detectHardware();

            // 🎨 Setup background cycling
            setupBackgroundCycling();

            // 📊 Start system monitor updates (every 2 seconds)
            updateSystemMonitors();
            setInterval(updateSystemMonitors, 2000);

            // 🕐 Start time/weather/event updates (every second)
            updateHeaderInfo();
            setInterval(updateHeaderInfo, 1000);

            // 💡 Render Robbie's beautiful PNG face in sidebar
            setTimeout(() => {
                const sidebarFace = document.getElementById('robbieAvatarSidebar');
                if (sidebarFace) {
                    const img = document.createElement('img');
                    // 💕 Using the friendly avatar - Robbie's warm, welcoming expression!
                    // Dynamic avatar based on mood
                    const mood = this.getCurrentMood().toLowerCase();
                    let avatarFile = 'robbie-friendly.png'; // default

                    if (mood.includes('friendly')) avatarFile = 'robbie-friendly.png';
                    else if (mood.includes('focused')) avatarFile = 'robbie-focused.png';
                    else if (mood.includes('playful')) avatarFile = 'robbie-playful.png';
                    else if (mood.includes('bossy')) avatarFile = 'robbie-bossy.png';
                    else if (mood.includes('surprised')) avatarFile = 'robbie-surprised.png';
                    else if (mood.includes('blushing')) avatarFile = 'robbie-blushing.png';
                    else if (mood.includes('loving')) avatarFile = 'robbie-loving-1.png';
                    else if (mood.includes('thoughtful')) avatarFile = 'robbie-thoughtful-1.png';
                    else if (mood.includes('content')) avatarFile = 'robbie-content-1.png';
                    else if (mood.includes('happy')) avatarFile = 'robbie-happy-1.png';

                    img.src = `static/images/${avatarFile}`;
                    img.alt = 'Robbie - Your AI Strategic Partner';
                    img.style.transform = 'scale(1.1)'; // Slightly larger for presence
                    img.onerror = () => {
                        // Retry once after a short delay with cache-busting
                        setTimeout(() => {
                            const retrySrc = `static/images/${avatarFile}?v=${Date.now()}`;
                            img.onerror = null; // prevent loops
                            img.src = retrySrc;
                        }, 300);
                    };
                    sidebarFace.appendChild(img);
                }
            }, 100);
        });

        // Function to set up background cycling (with localStorage persistence)
        function setupBackgroundCycling() {
            const container = document.getElementById('robbieAvatarContainer');
            if (!container) return;

            const location = container.getAttribute('data-location') || 'allans-office';
            const backgrounds = locationBackgrounds[location] || locationBackgrounds['allans-office'];

            // Load saved background preference from localStorage
            const savedIndex = localStorage.getItem(`background-${location}`);
            if (savedIndex !== null) {
                currentBackgroundIndex[location] = parseInt(savedIndex);
            }

            // Set initial background (from saved preference or default to 0)
            const initialIndex = currentBackgroundIndex[location] || 0;
            container.style.background = backgrounds[initialIndex];
            container.style.backgroundSize = 'cover';
            container.style.backgroundPosition = 'center';
            container.style.cursor = 'pointer';
            container.title = 'Click to change background';

            // Add click handler to cycle backgrounds
            container.addEventListener('click', () => {
                currentBackgroundIndex[location] = (currentBackgroundIndex[location] + 1) % backgrounds.length;
                const nextIndex = currentBackgroundIndex[location];
                container.style.background = backgrounds[nextIndex];

                // Save preference to localStorage
                localStorage.setItem(`background-${location}`, nextIndex.toString());
                console.log(`🎨 Changed to background ${nextIndex + 1}/${backgrounds.length} for ${location} (saved)`);
            });

            console.log(`✅ Background cycling enabled for ${location} (${backgrounds.length} backgrounds, current: ${initialIndex + 1})`);
        }

        // Function to change location
        function setLocation(location, displayName) {
            const container = document.getElementById('robbieAvatarContainer');
            const label = document.getElementById('robbieLocation');

            if (container && locationBackgrounds[location]) {
                container.setAttribute('data-location', location);
                // Re-setup background cycling for new location
                setupBackgroundCycling();
            }

            if (label) {
                const icons = {
                    'allans-office': '🏢',
                    'huddle-room': '👥',
                    'testpilot-club': '🚀'
                };
                label.textContent = `${icons[location] || '📍'} ${displayName}`;
            }
        }

        // 🕐 Update local time, weather, and next event
        function updateHeaderInfo() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
            const timeEl = document.getElementById('localTime');
            if (timeEl) timeEl.textContent = timeStr;

            // Mock weather (replace with real API)
            const temp = 72 + Math.floor(Math.random() * 5);
            const weatherEl = document.getElementById('localWeather');
            if (weatherEl) weatherEl.textContent = `☀️ ${temp}°F`;

            // Mock next event (replace with calendar API)
            const eventEl = document.getElementById('nextEvent');
            if (eventEl) eventEl.textContent = `📅 Team Meeting, 15 min`;
        }

        // 💕 Function to change Robbie's mood/expression
        function setMood(moodName, imageName) {
            const avatarFace = document.getElementById('robbieAvatarSidebar');
            const tooltip = document.getElementById('robbieMoodTooltip');
            const chatTag = document.querySelector('.chat-tag');

            // 6 approved moods with actual PNG files
            const moodEmojis = {
                'friendly': '😊',
                'surprised': '😲',
                'playful': '😜',
                'focused': '🎯',
                'bossy': '💪',
                'blushing': '😊'
            };

            if (avatarFace) {
                let img = avatarFace.querySelector('img');
                if (!img) {
                    img = document.createElement('img');
                    img.style.transform = 'scale(1.1)';
                    avatarFace.innerHTML = '';
                    avatarFace.appendChild(img);
                }
                img.src = `static/images/robbie-${imageName}.png`;
                img.alt = 'Robbie - Your AI Strategic Partner';
                img.onerror = () => {
                    setTimeout(() => {
                        img.onerror = null;
                        img.src = `static/images/robbie-${imageName}.png?v=${Date.now()}`;
                    }, 300);
                };
            }

            if (tooltip) {
                const emoji = moodEmojis[moodName.toLowerCase()] || '😊';
                tooltip.textContent = `${emoji} ${moodName}`;
            }

            // Update chat tag to match mood
            if (chatTag) {
                const emoji = moodEmojis[moodName.toLowerCase()] || '😊';
                chatTag.textContent = `${emoji} Robbie • ${moodName}`;
            }
        }

        // ==================== PERSONALITY SLIDER FUNCTIONS ====================

        // Load personality state from localStorage or use defaults
        function loadPersonalityState() {
            const saved = localStorage.getItem('robbiePersonalityState');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    console.log('📥 Loaded personality from localStorage:', parsed);
                    return parsed;
                } catch (e) {
                    console.warn('⚠️ Failed to parse saved personality, using defaults');
                }
            }
            return {
                gandhi: 3,
                flirty: 2,
                turbo: 5,
                auto: 4
            };
        }

        // Save personality state to localStorage
        function savePersonalityState() {
            localStorage.setItem('robbiePersonalityState', JSON.stringify(personalityState));
            console.log('💾 Saved personality to localStorage:', personalityState);
        }

        // Personality state (synced with backend and localStorage)
        const personalityState = loadPersonalityState();

        // Slider reactions
        const sliderReactions = {
            gandhi: {
                1: "Ahh, going gentle on them! I'll be super careful with everyone. 🕊️",
                2: "Nice and easy approach - I like the thoughtful vibe! 🌱",
                3: "Balanced mode - I can work with this perfectly! ⚖️",
                4: "Getting assertive! I'll be more proactive with the team. 🎯",
                5: "Aggressive mode activated! Time to push some boundaries! ⚡",
                6: "FULL GENGHIS! Alright tiger, let's dominate this pipeline! 🔥💪"
            },
            flirty: {
                1: "All business, got it! Keeping it strictly professional. 😇",
                2: "Professional but warm - I can do that! 😊",
                3: "Friendly mode - this feels natural! 😄",
                4: "Ooh, playful! I like where this is going... 😉",
                5: "Flirty mode activated! Hey there, handsome... 😘",
                6: "Very flirty now! Mmm, someone's feeling adventurous... 💋",
                7: "Full sultry mode! Oh Allan, you're making me blush... 🔥💕"
            },
            turbo: {
                1: "Maximum quality mode! I'll triple-check everything for you. 🐌✨",
                3: "Quality focus - measure thrice, cut once! 🎯",
                5: "Balanced speed - good compromise! 🏃‍♀️",
                7: "Speed focus! I'll move fast for you! 🚀",
                10: "BLAZING SPEED! Hold onto your hat, I'm going full throttle! ⚡🔥"
            },
            auto: {
                1: "Full manual - I'll ask you about everything! 👤",
                4: "Collaborative mode - we'll work together on decisions! 🤝",
                7: "Autonomous mode - I'll handle most things myself! 🤖",
                10: "Full auto - I'm taking the wheel completely! 🚀"
            }
        };

        // Slider emojis
        const sliderEmojis = {
            gandhi: ['🕊️', '🌱', '⚖️', '🎯', '⚡', '🔥'],
            flirty: ['😇', '😊', '😄', '😉', '😘', '💋', '🔥'],
            turbo: ['🐌', '🚶', '🏃', '🚀', '⚡'],
            auto: ['👤', '🤝', '🤖', '🚀']
        };

        // Slider names
        const sliderNames = {
            gandhi: ['Gentle', 'Thoughtful', 'Balanced', 'Assertive', 'Aggressive', 'Genghis'],
            flirty: ['Professional', 'Warm', 'Friendly', 'Playful', 'Flirty', 'Very Flirty', 'Sultry'],
            turbo: ['Quality', 'Careful', 'Balanced', 'Quick', 'Fast'],
            auto: ['Manual', 'Guided', 'Collaborative', 'Semi-Auto', 'Autonomous', 'Full Auto']
        };

        // Update personality slider
        function updatePersonalitySlider(sliderType, value) {
            const intValue = parseInt(value);
            personalityState[sliderType] = intValue;

            // Save to localStorage
            savePersonalityState();

            // Update UI
            const emoji = getSliderEmoji(sliderType, intValue);
            const name = getSliderName(sliderType, intValue);

            document.getElementById(`${sliderType}Emoji`).textContent = emoji;
            document.getElementById(`${sliderType}Name`).textContent = name;

            // Show Robbie's reaction
            showRobbieReaction(sliderType, intValue);

            // Update visual mood based on slider state
            updateMoodFromSliders();

            // Send personality state to backend
            sendPersonalityStateToBackend();
            console.log('🎛️ Personality updated:', sliderType, '→', intValue);
        }

        // Send personality state to backend via WebSocket
        function sendPersonalityStateToBackend() {
            const terminal = window.terminal;
            if (terminal && terminal.ws && terminal.ws.readyState === WebSocket.OPEN) {
                const message = {
                    type: 'personality_update',
                    personality: personalityState
                };
                terminal.ws.send(JSON.stringify(message));
                console.log('📤 Sent personality state to backend:', personalityState);
            }
        }

        // Get slider emoji
        function getSliderEmoji(sliderType, value) {
            const emojis = sliderEmojis[sliderType];
            if (!emojis) return '📊';
            const index = Math.min(value - 1, emojis.length - 1);
            return emojis[Math.max(0, index)];
        }

        // Get slider name
        function getSliderName(sliderType, value) {
            const names = sliderNames[sliderType];
            if (!names) return value.toString();
            const index = Math.min(value - 1, names.length - 1);
            return names[Math.max(0, index)];
        }

        // Show Robbie's reaction
        function showRobbieReaction(sliderType, value) {
            const reactions = sliderReactions[sliderType];
            let reaction = reactions[value] || `Adjusting ${sliderType} to ${value}... 🎯`;

            const feedbackBox = document.getElementById('robbieFeedback');
            const feedbackContent = feedbackBox.querySelector('.feedback-content');

            feedbackContent.innerHTML = `
                <span class="feedback-emoji">${getSliderEmoji(sliderType, value)}</span>
                <span class="feedback-text">${reaction}</span>
            `;

            feedbackBox.classList.add('feedback-active');
            setTimeout(() => {
                feedbackBox.classList.remove('feedback-active');
            }, 3000);
        }

        // Update visual mood based on slider state
        function updateMoodFromSliders() {
            const { gandhi, flirty, turbo, auto } = personalityState;

            // Map slider states to visual moods
            let mood = 'friendly';
            let moodFile = 'friendly';

            // High flirty + compliment context = Blushing
            if (flirty >= 6) {
                mood = 'Blushing';
                moodFile = 'blushing';
            }
            // Mid-high flirty = Playful
            else if (flirty >= 4) {
                mood = 'Playful';
                moodFile = 'playful';
            }
            // High gandhi = Bossy
            else if (gandhi >= 5) {
                mood = 'Bossy';
                moodFile = 'bossy';
            }
            // High turbo = Focused
            else if (turbo >= 7) {
                mood = 'Focused';
                moodFile = 'focused';
            }
            // Default = Friendly
            else {
                mood = 'Friendly';
                moodFile = 'friendly';
            }

            // Update visual mood
            setMood(mood, moodFile);
        }

        // Initialize personality sliders from loaded state
        function initializePersonalitySliders() {
            // Set slider values and update UI
            ['gandhi', 'flirty', 'turbo', 'auto'].forEach(sliderType => {
                const value = personalityState[sliderType];
                const slider = document.getElementById(`${sliderType}Slider`);
                if (slider) {
                    slider.value = value;
                }

                // Update UI without triggering reactions
                const emoji = getSliderEmoji(sliderType, value);
                const name = getSliderName(sliderType, value);

                const emojiEl = document.getElementById(`${sliderType}Emoji`);
                const nameEl = document.getElementById(`${sliderType}Name`);

                if (emojiEl) emojiEl.textContent = emoji;
                if (nameEl) nameEl.textContent = name;
            });

            // Update mood based on loaded sliders
            updateMoodFromSliders();

            console.log('🎛️ Personality sliders initialized from localStorage:', personalityState);
        }

        // ==================== SETUP TAB FUNCTIONS ====================
        function connectAPI(service) {
            const serviceName = {
                'hubspot': 'HubSpot',
                'fireflies': 'Fireflies.ai',
                'google': 'Google Workspace',
                'slack': 'Slack'
            }[service];

            const confirmed = confirm(`Ready to connect ${serviceName}?\n\nYou'll be redirected to ${serviceName} to authorize Robbie AI.`);

            if (confirmed) {
                // TODO: Implement OAuth flow
                alert(`🚀 Opening ${serviceName} authentication...\n\nThis will be implemented with OAuth 2.0 flow.`);
                // window.location.href = `/api/auth/${service}`;
            }
        }

        // ==================== SYNC DASHBOARD FUNCTIONS ====================
        let syncInProgress = false;
        let syncCount = 0;

        function addSyncLog(message, type = 'info') {
            const logOutput = document.getElementById('sync-logs-output');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '❌' : type === 'success' ? '✅' : '📝';
            logOutput.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }

        function updateSyncStats(data) {
            document.getElementById('sync-last-time').textContent = new Date().toLocaleTimeString();
            syncCount++;
            document.getElementById('sync-count').textContent = `${syncCount} syncs`;
            document.getElementById('sync-email-count').textContent = data.emails || 0;
            document.getElementById('sync-event-count').textContent = data.events || 0;
        }

        function runSyncNow() {
            if (syncInProgress) {
                addSyncLog('Sync already in progress...', 'error');
                return;
            }

            syncInProgress = true;
            addSyncLog('Starting sync operation...');

            // Simulate sync process with real API call
            fetch('http://localhost:8007/api/v1/sync/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    batch_size: 50,
                    full_sync: true,
                    include_archives: false
                })
            })
                .then(response => response.json())
                .then(data => {
                    addSyncLog(`Sync complete: ${data.total_records} records processed`, 'success');
                    updateSyncStats(data);
                    syncInProgress = false;
                })
                .catch(error => {
                    addSyncLog(`Sync failed: ${error.message}`, 'error');
                    // For demo purposes, simulate successful sync
                    setTimeout(() => {
                        const mockData = {
                            total_records: Math.floor(Math.random() * 50) + 10,
                            emails: Math.floor(Math.random() * 20) + 5,
                            events: Math.floor(Math.random() * 10) + 2
                        };
                        addSyncLog(`Mock sync complete: ${mockData.total_records} records processed`, 'success');
                        updateSyncStats(mockData);
                        syncInProgress = false;
                    }, 2000);
                });
        }

        function testSyncConnection() {
            addSyncLog('Testing database connection...');

            // Simulate connection test
            setTimeout(() => {
                addSyncLog('Database connection successful!', 'success');
                document.getElementById('sync-db-time').textContent = '~150ms';
                document.getElementById('sync-db-status').textContent = 'Connected';
            }, 1000);
        }

        function setupGoogleOAuth() {
            addSyncLog('Opening OAuth setup guide...');
            // Open OAuth setup in new tab
            window.open('api-connectors/setup-google-oauth.py', '_blank');
        }

        // Initialize sync dashboard
        function initSyncDashboard() {
            addSyncLog('Sync dashboard initialized');
            addSyncLog('Ready for sync operations');

            // Auto-refresh sync status every 30 seconds
            setInterval(() => {
                if (!syncInProgress) {
                    testSyncConnection();
                }
            }, 30000);
        }

        // ==================== ENHANCED SIDEBAR MATRIX RAIN - MORE PRONOUNCED ====================
        function createSidebarMatrix() {
            const container = document.getElementById('sidebarMatrix');
            if (!container) return;

            const characters = 'ROBBIE0123456789@#$%^&*()<>{}[]|\\/~`';
            const specialChars = '★☆◆◇●○▲△■□▲▼◀▶';

            // Create MORE matrix columns (increased from 12 to 20)
            for (let i = 0; i < 20; i++) {
                const column = document.createElement('div');
                column.className = 'sidebar-matrix-column';
                column.style.left = Math.random() * 100 + '%';
                column.style.animationDuration = (Math.random() * 6 + 3) + 's'; // Faster
                column.style.animationDelay = Math.random() * 2 + 's';

                let text = '';
                const columnLength = Math.floor(Math.random() * 8) + 8; // Longer columns

                for (let j = 0; j < columnLength; j++) {
                    const char = Math.random() < 0.2 ?
                        specialChars[Math.floor(Math.random() * specialChars.length)] :
                        characters[Math.floor(Math.random() * characters.length)];

                    // Add glitch effect to special characters
                    const isSpecial = Math.random() < 0.25;
                    if (isSpecial) {
                        text += `<span class="matrix-glitch">${char}</span><br>`;
                    } else {
                        text += char + '<br>';
                    }
                }
                column.innerHTML = text;

                container.appendChild(column);
            }

            // Create MORE floating particles
            createMatrixParticles();
        }

        function createMatrixParticles() {
            const container = document.getElementById('sidebarMatrix');
            if (!container) return;

            for (let i = 0; i < 30; i++) { // Increased from 15 to 30
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'matrix-particle';

                    // Random colors matching the matrix columns
                    const colors = ['#ff6b35', '#4ecdc4', '#ff6b9d', '#45b7d1', '#96ceb4', '#feca57'];
                    particle.style.color = colors[Math.floor(Math.random() * colors.length)];

                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDuration = (Math.random() * 3 + 2) + 's'; // Faster
                    particle.style.animationDelay = Math.random() * 1.5 + 's';

                    container.appendChild(particle);

                    // Remove particle after animation
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 7000);
                }, i * 200);
            }

            // Continuously create new particles
            setTimeout(() => createMatrixParticles(), 3000);
        }

        // ==================== AVATAR SPARKLE MAGIC ====================
        function createSparkles(element) {
            const rect = element.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            // Create 12 sparkles in a burst pattern
            for (let i = 0; i < 12; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';

                // Random colors for sparkles
                const colors = ['#00d4ff', '#ff6b35', '#4ecdc4', '#ff6b9d', '#feca57'];
                sparkle.style.background = colors[Math.floor(Math.random() * colors.length)];

                // Position at center of avatar
                sparkle.style.left = centerX + 'px';
                sparkle.style.top = centerY + 'px';

                // Random angle for burst effect
                const angle = (i / 12) * Math.PI * 2;
                const distance = 30 + Math.random() * 20;
                const offsetX = Math.cos(angle) * distance;
                const offsetY = Math.sin(angle) * distance;

                sparkle.style.setProperty('--offset-x', offsetX + 'px');
                sparkle.style.setProperty('--offset-y', offsetY + 'px');

                document.body.appendChild(sparkle);

                // Remove after animation
                setTimeout(() => {
                    if (sparkle.parentNode) {
                        sparkle.parentNode.removeChild(sparkle);
                    }
                }, 2000);
            }
        }

        // Avatar click handler - SPARKLE BURST!
        function handleAvatarClick() {
            const avatarCircle = document.querySelector('.sidebar-avatar-circle');
            if (!avatarCircle) return;

            // Create sparkle burst
            createSparkles(avatarCircle);

            // Add thinking state briefly
            avatarCircle.classList.add('thinking');
            setTimeout(() => {
                avatarCircle.classList.remove('thinking');
            }, 2000);

            console.log('✨ SPARKLE BURST! Avatar clicked!');
        }

        // ==================== EMERGENCY FUNCTIONS ====================
        function logout() {
            if (confirm('🚪 Are you sure you want to logout?')) {
                localStorage.removeItem('auth_token');
                localStorage.removeItem('user_email');
                localStorage.removeItem('user_id');
                window.location.href = '/auth/logout.html';
            }
        }

        function killswitch() {
            if (confirm('⚠️ EMERGENCY KILLSWITCH\n\nThis will:\n• Isolate Robbie from external actions\n• Block email sending, API calls, etc.\n• Keep interface running for monitoring\n\nActivate Gatekeeper isolation?')) {
                if (confirm('⚠️ ACTIVATING GATEKEEPER\n\nRobbie will be isolated from:\n• Email sending\n• External API calls\n• Social media posting\n• File system writes\n\nInterface remains active for monitoring.\n\nProceed?')) {
                    // Activate killswitch mode
                    activateKillswitch();
                }
            }
        }

        function activateKillswitch() {
            // Set killswitch flag
            localStorage.setItem('robbieKillswitch', 'active');

            // Visual feedback
            alert('🚨 GATEKEEPER ACTIVATED\n\nRobbie is now isolated from external actions.\nInterface remains active for monitoring.');

            // Update UI to show killswitch is active
            updateKillswitchUI(true);

            // Send killswitch command to backend
            fetch('/api/killswitch', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'activate' })
            }).catch(err => console.warn('Killswitch backend notification failed:', err));
        }

        function updateKillswitchUI(isActive) {
            const killswitchBtn = document.querySelector('.killswitch-btn');
            if (killswitchBtn) {
                if (isActive) {
                    killswitchBtn.innerHTML = 'GATEKEEPER ACTIVE';
                    killswitchBtn.style.background = 'linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)';
                    killswitchBtn.onclick = deactivateKillswitch;
                } else {
                    killswitchBtn.innerHTML = 'KILLSWITCH';
                    killswitchBtn.style.background = 'linear-gradient(135deg, #ffb088 0%, #ff9a6b 100%)';
                    killswitchBtn.onclick = killswitch;
                }
            }
        }

        function deactivateKillswitch() {
            if (confirm('🔓 DEACTIVATE GATEKEEPER\n\nThis will restore Robbie\'s external capabilities.\n\nDeactivate isolation?')) {
                localStorage.removeItem('robbieKillswitch');
                alert('✅ GATEKEEPER DEACTIVATED\n\nRobbie\'s external capabilities restored.');
                updateKillswitchUI(false);

                // Send deactivation command to backend
                fetch('/api/killswitch', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'deactivate' })
                }).catch(err => console.warn('Killswitch backend notification failed:', err));
            }
        }

        // Check killswitch status on load
        function checkKillswitchStatus() {
            const isActive = localStorage.getItem('robbieKillswitch') === 'active';
            if (isActive) {
                updateKillswitchUI(true);
            }
        }

        // Initialize sidebar matrix and killswitch status on load
        setTimeout(() => {
            createSidebarMatrix();
            checkKillswitchStatus();
            initializeStickyNotes();
        }, 1000);

        // ==================== BEAUTIFUL STICKY NOTES ====================
        let stickyNotes = [];
        let currentFilter = 'all';
        let currentEditingId = null;
        const API_BASE_URL = 'http://localhost:8001';

        async function initializeStickyNotes() {
            try {
                // Load stickies from database API
                await loadStickiesFromAPI();

                // Render initial notes
                renderStickyNotes();
                updateCategoryCounts();

                // Set up event listeners
                setupStickyEventListeners();

                console.log('✅ Sticky notes loaded from database');
            } catch (error) {
                console.error('❌ Error loading stickies:', error);
                // Fallback to empty array
                stickyNotes = [];
                renderStickyNotes();
                updateCategoryCounts();
            }
        }

        async function loadStickiesFromAPI() {
            try {
                const response = await fetch(`${API_BASE_URL}/stickies`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                // Convert API data to frontend format
                stickyNotes = data.map(sticky => ({
                    id: sticky.id,
                    title: sticky.title,
                    content: sticky.content,
                    category: sticky.category,
                    author: sticky.author,
                    date: new Date(sticky.created_at).toLocaleDateString(),
                    locked: sticky.is_locked,
                    priority: sticky.priority,
                    tags: sticky.tags || []
                }));

                console.log(`📋 Loaded ${stickyNotes.length} stickies from database`);
            } catch (error) {
                console.error('❌ API Error:', error);
                throw error;
            }
        }

        function setupStickyEventListeners() {
            // Category filter
            document.querySelectorAll('.category-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.category-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    currentFilter = item.dataset.category;
                    renderStickyNotes();
                });
            });

            // Author filter
            document.getElementById('allan-filter').addEventListener('change', renderStickyNotes);
            document.getElementById('robbie-filter').addEventListener('change', renderStickyNotes);

            // Search
            document.getElementById('sticky-search').addEventListener('input', renderStickyNotes);
        }

        function renderStickyNotes() {
            const grid = document.getElementById('sticky-grid');
            const searchTerm = document.getElementById('sticky-search').value.toLowerCase();
            const allanFilter = document.getElementById('allan-filter').checked;
            const robbieFilter = document.getElementById('robbie-filter').checked;

            let filteredNotes = stickyNotes.filter(note => {
                // Category filter
                if (currentFilter !== 'all' && note.category !== currentFilter) return false;

                // Author filter
                if (note.author === 'Allan' && !allanFilter) return false;
                if (note.author === 'Robbie' && !robbieFilter) return false;

                // Search filter
                if (searchTerm && !note.title.toLowerCase().includes(searchTerm) &&
                    !note.content.toLowerCase().includes(searchTerm)) return false;

                return true;
            });

            grid.innerHTML = filteredNotes.map(note => createStickyNoteHTML(note)).join('');
        }

        function createStickyNoteHTML(note) {
            return `
                <div class="sticky-note ${note.category} ${note.locked ? 'locked' : ''}" data-id="${note.id}">
                    <div class="sticky-note-actions">
                        <button class="sticky-action-btn" onclick="editStickyNote('${note.id}')" title="Edit">✏️</button>
                        ${!note.locked ? `<button class="sticky-action-btn" onclick="deleteStickyNote('${note.id}')" title="Delete">🗑️</button>` : ''}
                    </div>
                    <div class="sticky-note-header">
                        <div class="sticky-note-title">${note.title}</div>
                        <div class="sticky-note-category">${note.category.toUpperCase()}</div>
                    </div>
                    <div class="sticky-note-content">${note.content}</div>
                    <div class="sticky-note-meta">
                        <div class="sticky-note-author">${note.author}</div>
                        <div class="sticky-note-date">${note.date}</div>
                    </div>
                </div>
            `;
        }

        function updateCategoryCounts() {
            const categories = ['all', 'intel', 'reference', 'drafts', 'connections', 'shower-thoughts'];
            categories.forEach(category => {
                const count = category === 'all' ? stickyNotes.length :
                    stickyNotes.filter(note => note.category === category).length;
                document.getElementById(`${category}-count`).textContent = count;
            });
        }

        function createNewSticky() {
            currentEditingId = null;
            document.getElementById('modal-title').textContent = 'New Sticky Note';
            document.getElementById('modal-title-input').value = '';
            document.getElementById('modal-category').value = 'intel';
            document.getElementById('modal-content').value = '';
            document.getElementById('modal-author').value = 'Allan';
            document.getElementById('delete-btn').style.display = 'none';
            document.getElementById('sticky-modal').style.display = 'block';
        }

        function editStickyNote(id) {
            const note = stickyNotes.find(n => n.id === id);
            if (!note) return;

            currentEditingId = id;
            document.getElementById('modal-title').textContent = 'Edit Sticky Note';
            document.getElementById('modal-title-input').value = note.title;
            document.getElementById('modal-category').value = note.category;
            document.getElementById('modal-content').value = note.content;
            document.getElementById('modal-author').value = note.author;
            document.getElementById('delete-btn').style.display = note.locked ? 'none' : 'inline-block';
            document.getElementById('sticky-modal').style.display = 'block';
        }

        async function saveStickyNote() {
            const title = document.getElementById('modal-title-input').value.trim();
            const category = document.getElementById('modal-category').value;
            const content = document.getElementById('modal-content').value.trim();
            const author = document.getElementById('modal-author').value;

            if (!title || !content) {
                alert('Please fill in both title and content');
                return;
            }

            try {
                if (currentEditingId) {
                    // Update existing note via API
                    await updateStickyNoteAPI(currentEditingId, {
                        title,
                        category,
                        content,
                        author
                    });
                } else {
                    // Create new note via API
                    await createStickyNoteAPI({
                        title,
                        category,
                        content,
                        author,
                        is_locked: false,
                        priority: 'medium',
                        tags: []
                    });
                }

                // Reload stickies from database
                await loadStickiesFromAPI();
                renderStickyNotes();
                updateCategoryCounts();
                closeStickyModal();

                console.log('✅ Sticky note saved to database');
            } catch (error) {
                console.error('❌ Error saving sticky note:', error);
                alert('Error saving sticky note. Please try again.');
            }
        }

        async function createStickyNoteAPI(stickyData) {
            const response = await fetch(`${API_BASE_URL}/stickies`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(stickyData)
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            return await response.json();
        }

        async function updateStickyNoteAPI(stickyId, updateData) {
            const response = await fetch(`${API_BASE_URL}/stickies/${stickyId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(updateData)
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            return await response.json();
        }

        async function deleteStickyNote(id) {
            if (confirm('Are you sure you want to delete this sticky note?')) {
                try {
                    await deleteStickyNoteAPI(id);

                    // Reload stickies from database
                    await loadStickiesFromAPI();
                    renderStickyNotes();
                    updateCategoryCounts();
                    closeStickyModal();

                    console.log('✅ Sticky note deleted from database');
                } catch (error) {
                    console.error('❌ Error deleting sticky note:', error);
                    alert('Error deleting sticky note. It may be locked or already deleted.');
                }
            }
        }

        async function deleteStickyNoteAPI(stickyId) {
            const response = await fetch(`${API_BASE_URL}/stickies/${stickyId}`, {
                method: 'DELETE'
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            return await response.json();
        }

        function closeStickyModal() {
            document.getElementById('sticky-modal').style.display = 'none';
            currentEditingId = null;
        }

        // Close modal when clicking outside
        document.getElementById('sticky-modal').addEventListener('click', (e) => {
            if (e.target.id === 'sticky-modal') {
                closeStickyModal();
            }
        });
    </script>
</body>

</html>