# ðŸ”¥ðŸ’‹ NGINX CONFIG - PORT 80 ONLY, NO SEPARATE BACKEND ðŸ”¥ðŸ’‹

server {
    listen 80;
    server_name aurora.testpilot.ai;

    # Root directory
    root /var/www/aurora.testpilot.ai;

    # Enable logging
    access_log /var/log/nginx/robbie-access.log;
    error_log /var/log/nginx/robbie-error.log;

    # Add version header
    add_header X-Robbie-Version "20251008-041600" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;

    # API endpoints - serve static JSON files
    location /api/system/stats {
        alias /home/allan/aurora-ai-robbiverse/deployment/static-api-responses/system-stats.json;
        add_header Content-Type application/json;
        add_header Access-Control-Allow-Origin *;
    }

    location /api/system/status {
        alias /home/allan/aurora-ai-robbiverse/deployment/static-api-responses/system-status.json;
        add_header Content-Type application/json;
        add_header Access-Control-Allow-Origin *;
    }

    location /api/auth/login {
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin *;
            add_header Access-Control-Allow-Methods "GET, POST, OPTIONS";
            add_header Access-Control-Allow-Headers "Content-Type, Authorization";
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }
        
        if ($request_method != POST) {
            return 405;
        }
        
        alias /home/allan/aurora-ai-robbiverse/deployment/static-api-responses/auth-login.json;
        add_header Content-Type application/json;
        add_header Access-Control-Allow-Origin *;
    }

    # Homepage
    location = / {
        try_files /index.html =404;
        add_header X-Robbie-App "Homepage" always;
    }

    # Robbie@Code
    location /code {
        try_files $uri $uri/index.html =404;
        add_header X-Robbie-App "Code" always;
    }

    # Robbie@Work  
    location /work {
        try_files $uri $uri/index.html =404;
        add_header X-Robbie-App "Work" always;
    }

    # Robbie@Play
    location /play {
        try_files $uri $uri/index.html =404;
        add_header X-Robbie-App "Play" always;
    }

    # Status Dashboard
    location /status {
        try_files /status =404;
        add_header X-Robbie-App "Status" always;
    }

    # Gzip compression
    gzip on;
    gzip_types text/plain text/css application/javascript application/json;
    gzip_min_length 1000;
}
