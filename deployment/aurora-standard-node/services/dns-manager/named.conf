// BIND9 Configuration for Aurora DNS Management
// This is the main configuration file

options {
    directory "/var/cache/bind";
    
    // Listen on all interfaces
    listen-on port 53 { any; };
    listen-on-v6 port 53 { any; };
    
    // Allow queries from Aurora mesh
    allow-query { 
        10.0.0.0/24;  // Aurora VPN mesh
        127.0.0.1;    // Localhost
    };
    
    // Allow recursion for Aurora mesh
    allow-recursion { 
        10.0.0.0/24;  // Aurora VPN mesh
        127.0.0.1;    // Localhost
    };
    
    // Forward external queries to public DNS
    forwarders {
        8.8.8.8;
        8.8.4.4;
        1.1.1.1;
        1.0.0.1;
    };
    
    // Enable DNSSEC
    dnssec-enable yes;
    dnssec-validation yes;
    
    // Logging
    logging {
        channel default_log {
            file "/var/log/bind/bind.log" versions 3 size 5m;
            severity info;
        };
        channel query_log {
            file "/var/log/bind/query.log" versions 3 size 5m;
            severity info;
        };
        category default { default_log; };
        category queries { query_log; };
    };
    
    // Security settings
    version "Aurora DNS 1.0";
    hostname "aurora-dns";
    server-id "aurora";
    
    // Rate limiting
    rate-limit {
        responses-per-second 10;
        window 5;
    };
};

// Include local zones
include "/etc/bind/named.conf.local";

// Include Aurora zones
zone "aurora.local" {
    type master;
    file "/etc/bind/zones/aurora.local.zone";
    allow-update { 10.0.0.0/24; };
};

zone "robbie.local" {
    type master;
    file "/etc/bind/zones/robbie.local.zone";
    allow-update { 10.0.0.0/24; };
};

zone "testpilot.local" {
    type master;
    file "/etc/bind/zones/testpilot.local.zone";
    allow-update { 10.0.0.0/24; };
};

zone "robbieblocks.local" {
    type master;
    file "/etc/bind/zones/robbieblocks.local.zone";
    allow-update { 10.0.0.0/24; };
};

zone "leadershipquotes.local" {
    type master;
    file "/etc/bind/zones/leadershipquotes.local.zone";
    allow-update { 10.0.0.0/24; };
};

zone "heyshopper.local" {
    type master;
    file "/etc/bind/zones/heyshopper.local.zone";
    allow-update { 10.0.0.0/24; };
};
