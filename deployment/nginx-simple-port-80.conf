# ðŸ”¥ðŸ’‹ NGINX CONFIG - PORT 80 ONLY, SIMPLE API RESPONSES ðŸ”¥ðŸ’‹

server {
    listen 80;
    server_name aurora.testpilot.ai;

    # Root directory
    root /var/www/aurora.testpilot.ai;

    # Enable logging
    access_log /var/log/nginx/robbie-access.log;
    error_log /var/log/nginx/robbie-error.log;

    # Add version header
    add_header X-Robbie-Version "20251008-041600" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;

    # API endpoints - return JSON directly
    location /api/system/stats {
        add_header Content-Type application/json;
        add_header Access-Control-Allow-Origin *;
        return 200 '{"status":"ok","timestamp":"2025-10-08T04:39:00.000Z","version":"nginx-api-1.0.0","stats":{"total_components":4,"operational_components":4,"last_update":"2025-10-08T04:39:00.000Z"}}';
    }

    location /api/system/status {
        add_header Content-Type application/json;
        add_header Access-Control-Allow-Origin *;
        return 200 '{"timestamp":"2025-10-08T04:39:00.000Z","components":[{"component":"robbie-system","status":"operational","message":"All systems green","version":"20251008-041600","timestamp":"2025-10-08T04:39:00.000Z"},{"component":"homepage","status":"operational","message":"Login and app selector working","version":"20251008-041600","timestamp":"2025-10-08T04:39:00.000Z"},{"component":"robbie-code","status":"operational","message":"React app fully functional","version":"20251008-041600","timestamp":"2025-10-08T04:39:00.000Z"},{"component":"nginx-api","status":"operational","message":"API served directly from nginx port 80","version":"1.0.0","timestamp":"2025-10-08T04:39:00.000Z"}]}';
    }

    location /api/auth/login {
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin *;
            add_header Access-Control-Allow-Methods "GET, POST, OPTIONS";
            add_header Access-Control-Allow-Headers "Content-Type, Authorization";
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }
        
        if ($request_method != POST) {
            return 405;
        }
        
        add_header Content-Type application/json;
        add_header Access-Control-Allow-Origin *;
        return 200 '{"token":"nginx-token-123","user":{"email":"allan@testpilotcpg.com","name":"Allan"},"backend":"nginx-direct-port-80"}';
    }

    # Homepage
    location = / {
        try_files /index.html =404;
        add_header X-Robbie-App "Homepage" always;
    }

    # Robbie@Code
    location /code {
        try_files $uri $uri/index.html =404;
        add_header X-Robbie-App "Code" always;
    }

    # Robbie@Work  
    location /work {
        try_files $uri $uri/index.html =404;
        add_header X-Robbie-App "Work" always;
    }

    # Robbie@Play
    location /play {
        try_files $uri $uri/index.html =404;
        add_header X-Robbie-App "Play" always;
    }

    # Status Dashboard
    location /status {
        try_files /status =404;
        add_header X-Robbie-App "Status" always;
    }

    # Gzip compression
    gzip on;
    gzip_types text/plain text/css application/javascript application/json;
    gzip_min_length 1000;
}










